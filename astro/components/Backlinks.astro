---
interface BacklinkItem {
  url: string;
  title?: string;
  data?: {
    visibility?: string;
  };
}

interface Props {
  backlinks?: BacklinkItem[];
  heading?: string;
  ariaLabel?: string;
}

const props = Astro.props as Props;
const {
  backlinks = [],
  heading = "MentionnÃ© dans",
  ariaLabel = "Backlinks small",
} = props;

// âœ¨ NEW: Deduplicate backlinks by URL
const seenUrls = new Set();
const deduplicatedBacklinks = backlinks.filter((entry: BacklinkItem) => {
  if (seenUrls.has(entry.url)) {
    return false; // Skip duplicates
  }
  seenUrls.add(entry.url);
  return true;
});

const publicBacklinks = deduplicatedBacklinks.filter(
  (entry: BacklinkItem) => entry?.data?.visibility !== "private",
);
---

{
  publicBacklinks.length > 0 && (
    <>
      <hr />
      <article class="backlinks prose small tight">
        <p class="muted mb-d4 flow-row">{heading}</p>
        <nav aria-label={ariaLabel}>
          <ul>
             {publicBacklinks.map((item: BacklinkItem) => (
              <li>
                <a href={item.url}>{item.title ?? item.url}</a>
              </li>
            ))}
          </ul>
        </nav>
      </article>
    </>
  )
}

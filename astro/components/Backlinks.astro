---
const {
    backlinks = [],
    heading = "MentionnÃ© dans",
    ariaLabel = "Backlinks small",
} = Astro.props;

// âœ¨ NEW: Deduplicate backlinks by URL
const seenUrls = new Set();
const deduplicatedBacklinks = backlinks.filter((entry) => {
    if (seenUrls.has(entry.url)) {
        return false; // Skip duplicates
    }
    seenUrls.add(entry.url);
    return true;
});

const publicBacklinks = deduplicatedBacklinks.filter(
    (entry) => entry?.data?.visibility !== "private",
);
---

{
    publicBacklinks.length > 0 && (
        <>
            <hr />
            <article class="backlinks prose small tight">
                <div class="flow-3" style="orphans:10; widows:3;">
                    <p class="muted mb-d4 flow-row">{heading}</p>
                    <nav aria-label={ariaLabel}>
                        <ul class="menu">
                            {publicBacklinks.map((item) => (
                                <li>
                                    <a href={item.url}>
                                        {item.title ?? item.url}
                                    </a>
                                </li>
                            ))}
                        </ul>
                    </nav>
                </div>
            </article>
        </>
    )
}

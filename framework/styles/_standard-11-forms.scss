@use "standard-00-variables" as *;

/* =========================== */
/* FORMS                       */
/* =========================== */

/* Layout containers */

fieldset {
  display: grid;
  gap: 0;
  border: var(--border);
  border-radius: var(--radius);
  padding: var(--space) !important;
  background: color-mix(
    in srgb,
    var(--color-surface) 25%,
    var(--color-background)
  );
}

fieldset div,
fieldset p {
  margin: 0;
  padding: 0;
}

fieldset + button {
  margin-block-start: var(--space);
}

fieldset :last-child {
  margin-block-end: 0;
}

legend {
  font-weight: var(--font-weight-bold, bold);
  margin-inline-start: calc(var(--leading) * -1);
  padding-inline: var(--leading);
}

/* Inputs */
input,
textarea,
select {
  width: 100%;
  font-family: var(--font-interface), system-ui, sans-serif;
  @extend %padding-text;
  border-radius: var(--radius);
  color: var(--color-foreground);
  background: var(--color-surface);
  border: var(--border);
  box-shadow: var(--shadow);
  transition:
    background-color var(--transition),
    border-color var(--transition),
    outline-color var(--transition);
}

textarea {
  resize: vertical;
  min-height: var(--space-2);
}

input:focus,
textarea:focus,
select:focus {
  outline: var(--stroke-width) solid
    color-mix(in srgb, var(--color-accent) 25%, transparent);
  outline-offset: var(--stroke-width);
  border-color: color-mix(in srgb, var(--color-accent) 100%, transparent);
  background-color: color-mix(
    in srgb,
    var(--color-accent) 5%,
    var(--color-background)
  );
}

label + :is(input, textarea, select) {
  margin-block-start: var(--leading);
}

label {
  display: flex;
  align-items: center;
  gap: var(--space-half);
}

fieldset *:not(legend) + :is(label, select, button, .btn-group) {
  margin-block-start: var(--space);
}
fieldset *:not(legend) + .btn-group {
  margin-block-start: var(--space-2);
}

input + :is(button, .btn-group) {
  margin-block-start: var(--space-half);
}

fieldset label:has(input[type="checkbox"], input[type="radio"]) {
  margin-block-start: var(--space);
}
/* Checkbox/Radio */
input[type="checkbox"],
input[type="radio"] {
  appearance: none;
  -webkit-appearance: none;
  width: 0px;
  height: calc(1em + var(--space-half));
  top: 50%;
  border: var(--border);
  border-radius: var(--radius);
  background-color: var(--color-surface);
  cursor: pointer;
  position: relative;
  transition: all 0.2s ease;
  box-shadow: inset var(--shadow);
  outline: 0;

  &:hover {
    border-color: var(--color-accent);
  }
  &:focus-visible {
    outline: 2px solid var(--color-blue);
    outline-offset: 2px;
  }
  /* Checked state */
  &:checked {
    background-color: color-mix(
      in srgb,
      var(--color-accent) 70%,
      var(--color-surface)
    );
    box-shadow: var(--shadow);
    border: var(--stroke-width) solid var(--color-accent);
  }
  /* Checkmark using pseudo-element */
  &:checked::after {
    content: "";
    position: absolute;
    left: 0.57em;
    top: 0.35em;
    width: 0.4em;
    height: 0.7em;
    border: var(--stroke-width) solid var(--color-surface);
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }
}

input[type="radio"] {
  border-radius: 50%;
}

/* Hover state */

input[type="checkbox"][role="switch"] {
  top: 0;
  /* --- 1. DEFINE DIMENSIONS --- */
  --switch-height: calc(var(--space) - var(--trim));
  --switch-width: calc(
    var(--switch-height) * 1.8
  ); /* Try changing 1.5 to 3, it works! */
  --switch-padding: 2px;

  /* Thumb is height minus top/bottom padding */
  --switch-thumb-size: calc(var(--switch-height) - (var(--switch-padding) * 2));

  /*
     CALCULATE TRAVEL DISTANCE AUTOMATICALLY:
     Total Width - Thumb Width - (Left Padding + Right Padding)
  */
  --switch-travel: calc(var(--switch-width) - (var(--switch-thumb-size) * 2));

  /* --- 2. CONTAINER SETUP --- */
  appearance: none;
  display: inline-flex;
  align-items: center; /* Center vertical */
  justify-content: flex-start; /* Force thumb to start at left */

  box-sizing: border-box; /* Crucial: Includes padding in width calculation */
  padding: var(--switch-padding);

  height: var(--switch-height);
  width: var(--switch-width);

  border-radius: 9999px;
  border: 1px solid transparent;
  border: var(--border);
  cursor: pointer;

  /* Colors & Transition */
  background-color: var(--color-surface);
  box-shadow: inset var(--shadow);
  transition:
    background-color 0.2s ease-in-out,
    border-color 0.2s ease-in-out;

  &:focus-visible {
    outline: 0px solid var(--color-accent);
    outline-offset: 0px;
  }

  &:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }

  /* --- 3. THE THUMB --- */
  &::before {
    content: "";
    display: block;

    /* Fix the squeeze: Prevent thumb from shrinking or growing */
    flex-shrink: 0;
    flex-grow: 0;

    width: var(--switch-thumb-size);
    height: var(--switch-thumb-size);

    border-radius: 50%;
    background-color: var(--color-light);
    box-shadow: var(--shadow);

    /* Start at 0 (relative to the padding we set on parent) */
    transform: translateX(calc(-50% - (var(--switch-padding) * 0.5)));
    transition: transform 0.2s ease-in-out;

    /* Ensure pointer events don't interfere */
    pointer-events: none;
  }

  /* --- 4. CHECKED STATE --- */
  &:checked {
    background-color: var(--color-accent);
    box-shadow: inset var(--shadow);
    border-color: transparent;
  }

  &:checked::before {
    /* Move exactly the calculated empty space distance */
    transform: translateX(var(--switch-travel));
  }
}

input[type="range"] {
  -webkit-appearance: none; /* Webkit/Blink */
  appearance: none;
  background: transparent;
  cursor: pointer;
  /* Dimensions */
  height: 0.25em; /* Adjust track height */
  width: 100%;
  border-radius: 9999px;
  border: var(--border);
  outline: none;
  padding: 0;
  box-shadow: inset var(--shadow);

  padding: 0; /* Crucial: allows thumb to touch edges */
  border: none; /* Crucial: removes text-input borders */
  background-origin: border-box;
  transition: opacity 0.2s;
  /*
   * THE FILL MAGIC
   * uses the --slider-value variable passed in the style attribute
   */
  background: linear-gradient(
    to right,
    var(--color-primary, var(--color-accent)) 0%,
    var(--color-primary, var(--color-accent)) var(--slider-value),
    var(--color-track, var(--color-surface)) var(--slider-value),
    var(--color-track, var(--color-surface)) 100%
  );
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  height: 1.25rem;
  width: 1.25rem;
  border-radius: 50%;
  border: var(--border);
  background: var(--color-background);
  box-shadow: var(--shadow);

  /* Vertical alignment logic for Webkit:
     (Thumb Height / 2) - (Track Height / 2) * -1
  */
  margin-top: 0;
  transition: transform 0.1s ease;
}
input[type="range"]:hover::-webkit-slider-thumb {
  background: var(--color-secondary);
  border-color: var(--color-subtle);
}

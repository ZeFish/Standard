/* 1. Define Layer Order (Must be at the top of your CSS/SCSS) */
/* 'base' is your framework defaults, 'rhythm' is your flow logic */
@layer base, rhythm;

/* 2. Your Framework Defaults (Example) */
@layer base {
  h1 {
    margin-bottom: var(--space-4);
  }
  p {
    margin-bottom: var(--space);
  }
}

/* 3. Your Rhythm Logic */
@layer rhythm {
  $content-tags: "h1, h2, h3, h4, h5, h6," + "p, ul, ol, dl," +
    "blockquote, pre, figure, table, hr," +
    ".callout, .card, .box, form, fieldset";

  $wrapper-tags: "div, section, article, header, footer";
  $rhythm-participants: $content-tags + ", " + $wrapper-tags;

  :where(.rhythm) {
    display: flow-root;
    --flow-gap: var(--rhythm-gap, var(--space));

    // HYBRID RESET
    > *,
    :is(#{$rhythm-participants}) {
      margin-block: 0;
    }

    // HYBRID OWL
    > * + *,
    :is(#{$rhythm-participants}) + :is(#{$rhythm-participants}) {
      margin-block-start: var(--flow-gap);
    }

    // EXCEPTIONS
    * + :is(h1, h2, h3) {
      margin-block-start: calc(var(--flow-gap) * 1.5);
    }

    :is(h1, h2, h3, h4) + :is(h2, h3, h4, h5, h6) {
      margin-block-start: var(--space-half);
    }

    hr + * {
      margin-block-start: var(--flow-gap);
    }

    // THE FIREWALL
    .no-rhythm * {
      // MAGIC: Go back to whatever margins were defined in '@layer base'
      margin: revert-layer;
    }
  }
}

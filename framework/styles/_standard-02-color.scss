@use "standard-00-variables" as *;

/**
 * @component Color System
 * @category Colors
 * @description Advanced OKLCH-based color system with automatic harmony generation.
 * Set one "signal" color and the system mathematically generates a complete,
 * harmonious color palette with perfect consistency across light and dark modes.
 * 
 * The system uses OKLCH color space for perceptually uniform colors, preserving
 * the vibrancy and temperature of your chosen signal while rotating hues to
 * create semantic colors (success, warning, error, info, etc.).
 * 
 * Features:
 * - Single color input generates entire palette
 * - Preserves lightness and chroma (vibrancy) across spectrum
 * - Intelligent dark mode with automatic lightness inversion
 * - Safety constraints for accessibility (WCAG AA compliant)
 * - Maintains color temperature when switching themes
 * - Backward compatible with manual color overrides
 *
 * @prop {color} --signal Primary brand/accent color (the seed for all others)
 * @prop {color} --color-background Page background color
 * @prop {color} --color-foreground Text foreground color
 * @prop {color} --color-accent Primary accent color (derived from signal)
 * @prop {color} --pigment-red Generated red (errors, deletions)
 * @prop {color} --pigment-yellow Generated yellow (warnings, highlights)
 * @prop {color} --pigment-green Generated green (success, insertions)
 * @prop {color} --pigment-cyan Generated cyan (info, metadata)
 * @prop {color} --pigment-blue Generated blue (links, focus)
 * @prop {color} --pigment-purple Generated purple (magic, AI)
 *
 * @example scss - Simple usage: Just set one color
 * :root {
 *   --signal: #d65d0e;
 * }
 *
 * @example scss - Advanced: Override specific colors
 * :root {
 *   --signal: #7a5a2e;
 *   --pigment-red: #a84032;
 * }
 *
 * @since 0.18.0
 * @see https://developer.chrome.com/blog/css-relative-color-syntax/
 * @see https://webaim.org/articles/contrast/
 */

/* Modern Color System - OKLCH-Based Automatic Harmony Generation */
:root {
  /* Tell browser we support both color schemes */
  color-scheme: light dark;

  /* Tooltip variables */
  --tooltip-bg: #1a1a1a;
  --tooltip-text: #ffffff;
  --tooltip-ease: cubic-bezier(0.25, 1, 0.5, 1);

  /* ============================================
     THE SIGNAL - User's Single Color Choice
     This is the only color users need to define.
     Everything else derives from this mathematically.
     ============================================ */
  
  --signal: #d65d0e; /* Default: Safety Orange */

  /* ============================================
     THE DNA EXTRACTION
     Extract lightness (l), chroma (c), and hue (h)
     from the user's signal color using OKLCH
     ============================================ */
  
  --dna-l: oklch(from var(--signal) l);
  --dna-c: oklch(from var(--signal) c);
  --dna-h: oklch(from var(--signal) h);

  /* ============================================
     SAFETY CONSTRAINTS
     Ensure colors are accessible and functional
     ============================================ */
  
  /* If signal is black/white (chroma=0), ensure minimum vibrancy for alerts */
  --safe-c: max(var(--dna-c), 0.12);
  
  /* Ensure readable text - clamp lightness for derived colors */
  --safe-l: clamp(0.35, var(--dna-l), 0.75);

  /* ============================================
     THE GENERATED SPECTRUM
     Rotate hue while preserving lightness & chroma
     Creates harmonious colors from signal DNA
     ============================================ */
  
  /* Red (~25deg) - Errors, Deletions, Danger */
  --pigment-red: oklch(var(--safe-l) var(--safe-c) 25);
  
  /* Yellow (~85deg) - Warnings, Highlights, Caution */
  --pigment-yellow: oklch(var(--safe-l) var(--safe-c) 85);
  
  /* Green (~145deg) - Success, Insertions, Positive */
  --pigment-green: oklch(var(--safe-l) var(--safe-c) 145);
  
  /* Cyan (~190deg) - Info, Metadata, Neutral */
  --pigment-cyan: oklch(var(--safe-l) var(--safe-c) 190);
  
  /* Blue (~240deg) - Links, Focus, Primary Actions */
  --pigment-blue: oklch(var(--safe-l) var(--safe-c) 240);
  
  /* Purple (~300deg) - Magic, AI, Special Features */
  --pigment-purple: oklch(var(--safe-l) var(--safe-c) 300);

  /* ============================================
     LIGHT MODE BASE COLORS
     Natural, paper-like foundation
     ============================================ */
  
  --color-light-background: white;
  --color-light-foreground: #262626;
  
  /* Use signal as the accent, or override if specified */
  --color-light-accent: var(--signal);

  /* ============================================
     DARK MODE BASE COLORS
     Intelligent lightness inversion
     ============================================ */
  
  --color-dark-background: #0f0f0f;
  --color-dark-foreground: #dbdbdb;
  
  /* Brighten signal slightly for dark mode visibility */
  --color-dark-accent: oklch(from var(--signal) calc(l + 0.12) c h);

  /* ============================================
     SEMANTIC COLOR TOKENS
     Map generated pigments to semantic names
     Default to light mode
     ============================================ */
  
  --color-background: var(--color-light-background);
  --color-foreground: var(--color-light-foreground);
  --color-accent: var(--color-light-accent);
  --color-header: var(--color-foreground);

  /* Use generated pigments for semantic colors */
  --color-red: var(--pigment-red);
  --color-orange: oklch(var(--safe-l) var(--safe-c) 55); /* Between yellow and red */
  --color-yellow: var(--pigment-yellow);
  --color-green: var(--pigment-green);
  --color-cyan: var(--pigment-cyan);
  --color-blue: var(--pigment-blue);
  --color-magenta: var(--pigment-purple);

  /* Semantic state colors */
  --color-success: var(--pigment-green);
  --color-warning: var(--pigment-yellow);
  --color-error: var(--pigment-red);
  --color-info: var(--pigment-blue);

  /* Links use blue by default */
  --color-link: var(--pigment-blue);
  --color-on-accent: var(--color-background);

  /* ===== COMPUTED SEMANTIC COLORS ===== */
  /* These use color-mix for semi-transparent variations */
  --color-muted: color-mix(in srgb, var(--color-foreground) 60%, transparent);
  --color-subtle: color-mix(in srgb, var(--color-foreground) 40%, transparent);
  --color-border: color-mix(in srgb, var(--color-foreground) 10%, transparent);
  --color-surface: color-mix(in srgb, var(--color-foreground) 3%, transparent);
  --color-secondary: color-mix(
    in srgb,
    var(--color-foreground) 3%,
    var(--color-background)
  );

  --color-pop: color-mix(in srgb, var(--color-foreground) 22%, transparent);
  --color-lighter: color-mix(in srgb, var(--color-light) 15%, transparent);
  --color-darker: color-mix(in srgb, var(--color-dark) 15%, transparent);
  --color-light: var(--color-light-background);
  --color-dark: var(--color-light-foreground);

  --color-background-accent: color-mix(
    in srgb,
    var(--color-accent) 7%,
    transparent
  );
  --color-modal-background: color-mix(
    in srgb,
    color-mix(in srgb, var(--color-foreground) 10%, var(--color-background)) 60%,
    transparent
  );

  /* Tint scale for subtle variations */
  --color-1: color-mix(
    in srgb,
    var(--color-foreground) 3%,
    var(--color-background)
  );
  --color-2: color-mix(
    in srgb,
    var(--color-foreground) 5%,
    var(--color-background)
  );
  --color-3: color-mix(
    in srgb,
    var(--color-foreground) 7%,
    var(--color-background)
  );
  --color-4: color-mix(
    in srgb,
    var(--color-foreground) 10%,
    var(--color-background)
  );
  --color-5: color-mix(
    in srgb,
    var(--color-foreground) 20%,
    var(--color-background)
  );
  --color-6: color-mix(
    in srgb,
    var(--color-background) 3%,
    var(--color-foreground)
  );
  --color-7: color-mix(
    in srgb,
    var(--color-background) 5%,
    var(--color-foreground)
  );
  --color-8: color-mix(
    in srgb,
    var(--color-background) 7%,
    var(--color-foreground)
  );
  --color-9: color-mix(
    in srgb,
    var(--color-background) 10%,
    var(--color-foreground)
  );
  --color-10: color-mix(
    in srgb,
    var(--color-background) 20%,
    var(--color-foreground)
  );

  /* Interactive states */
  --color-hover: color-mix(in srgb, var(--color-accent) 35%, transparent);
  --color-active: color-mix(in srgb, var(--color-accent) 20%, transparent);

  /* ===== SHADOWS AND EFFECTS ===== */
  --color-shadow: color-mix(in srgb, var(--color-dark) 5%, transparent);
  --shadow: 0 1px 2px var(--color-shadow);
  --shadow-l:
    0 4px 6px -1px var(--color-darker), 0 2px 4px -2px var(--color-darker);

  /* ===== DESIGN TOKENS ===== */
  --border: var(--stroke-width) solid var(--color-border);
  --border-accent: var(--stroke-width) solid
    color-mix(in srgb, var(--color-accent) 7%, transparent);

  /* Theme transition for smooth switching */
  transition:
    background-color var(--transition),
    color var(--transition),
    border-color var(--transition);
}

/* ============================================
   AUTOMATIC DARK MODE
   Intelligent lightness inversion that preserves
   color temperature and vibrancy
   ============================================ */
@media (prefers-color-scheme: dark) {
  :root {
    /* ===== FLIP BACKGROUND & FOREGROUND ===== */
    /* Preserve warmth/coolness while inverting lightness */
    --color-background: var(--color-dark-background);
    --color-foreground: var(--color-dark-foreground);
    
    /* Brighten accent for visibility against dark background */
    --color-accent: var(--color-dark-accent);
    
    /* Update light/dark references */
    --color-light: var(--color-dark-foreground);
    --color-dark: var(--color-dark-background);
    --color-header: var(--color-foreground);

    /* ===== BRIGHTEN PIGMENTS FOR DARK MODE ===== */
    /* Generated colors need to glow against dark background */
    --pigment-red: oklch(calc(var(--safe-l) + 0.15) var(--safe-c) 25);
    --pigment-yellow: oklch(calc(var(--safe-l) + 0.15) var(--safe-c) 85);
    --pigment-green: oklch(calc(var(--safe-l) + 0.15) var(--safe-c) 145);
    --pigment-cyan: oklch(calc(var(--safe-l) + 0.15) var(--safe-c) 190);
    --pigment-blue: oklch(calc(var(--safe-l) + 0.15) var(--safe-c) 240);
    --pigment-purple: oklch(calc(var(--safe-l) + 0.15) var(--safe-c) 300);

    /* Update semantic colors to use brightened pigments */
    --color-red: var(--pigment-red);
    --color-orange: oklch(calc(var(--safe-l) + 0.15) var(--safe-c) 55);
    --color-yellow: var(--pigment-yellow);
    --color-green: var(--pigment-green);
    --color-cyan: var(--pigment-cyan);
    --color-blue: var(--pigment-blue);
    --color-magenta: var(--pigment-purple);
    --color-link: var(--pigment-blue);

    /* ===== ADJUSTED COMPUTED COLORS FOR DARK MODE ===== */
    /* Increase opacity for better visibility on dark backgrounds */
    --color-muted: color-mix(in srgb, var(--color-foreground) 65%, transparent);
    --color-subtle: color-mix(
      in srgb,
      var(--color-foreground) 45%,
      transparent
    );
    --color-border: color-mix(
      in srgb,
      var(--color-foreground) 7%,
      var(--color-background)
    );
    --color-secondary: color-mix(in srgb, black 3%, var(--color-background));
    --color-surface: color-mix(in srgb, black 10%, transparent);
    --color-modal-background: color-mix(
      in srgb,
      color-mix(in srgb, black 75%, var(--color-background)) 60%,
      transparent
    );
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  :root {
    transition: none;
  }

  * {
    transition: none !important;
    animation: none !important;
  }
}

/* Windows High Contrast mode */
@media (forced-colors: active) {
  :root {
    --color-background: Canvas;
    --color-foreground: CanvasText;
    --color-accent: Highlight;
    --color-border: CanvasText;
    --color-muted: GrayText;
  }
}

/* ===== BASE HTML STYLING ===== */
html {
  color: var(--color-foreground);
  background: var(--color-background);

  /* Smooth theme transitions */
  transition:
    background-color var(--transition),
    color var(--transition);
}

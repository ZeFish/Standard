:root {
    --marge: 1rlh;
    --marge-block: 2;
    --marge-gap: 0.25;

    --max-width: 100%;

    /* Spacing Tokens (Vertical Rhythm) */
    --space-xxxs: calc(var(--marge) / 5);
    --space-xxs: calc(var(--marge) / 4);
    --space-xs: calc(var(--marge) / 3);
    --space-s: calc(var(--marge) / 2);
    --space: var(--marge);
    --space-l: calc(2 * var(--marge));
    --space-xl: calc(3 * var(--marge));
    --space-xxl: calc(4 * var(--marge));
    --space-xxxl: calc(5 * var(--marge));

    --space-gap: calc(var(--marge) * var(--marge-gap));
    --space-block: calc(var(--marge) * var(--marge-block));
    --space-negative: calc(var(--marge) * -1);

    --hr-thickness: 1px;
    --border: var(--hr-thickness) solid var(--color-border);
    --border-radius: var(--space-xxs);

    --list-indentation: var(--space);
}

:first-child {
    margin-top: unset;
}
:last-child {
    margin-bottom: unset;
}

html {
    padding: 0;
    scroll-behavior: smooth;
}

body {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    overflow-x: hidden;
    padding: var(--space-l);
    max-width: var(--max-width);
    margin: auto;
}

article {
    --gap: clamp(var(--space), 6vw, var(--space-xl));
    --content: min(var(--line-width), 100% - var(--gap) * 2);
    --content-accent: minmax(0, var(--space-l));
    --content-feature: minmax(0, var(--space-xxl));
    --content-full: minmax(var(--gap), 1fr);

    display: grid;
    grid-template-columns:
        [full-start] var(--content-full)
        [feature-start] var(--content-feature)
        [accent-start] var(--content-accent)
        [content-start] var(--content) [content-end]
        var(--content-accent) [accent-end]
        var(--content-feature) [feature-end]
        var(--content-full) [full-end];

    /* If you prefer gutters instead of negative padding, replace with:
       padding-inline: var(--gap); */
    padding-left: calc(var(--space) * -2);
    padding-right: calc(var(--space) * -2);

    position: relative;
    z-index: 10;
}

article > * {
    grid-column: content;
    margin-bottom: var(--space-block);
}

article section {
    margin: 0 var(--space-xxl) var(--space) var(--space-xxl);
}

article .xsmall,
.img-xsmall article.note p:has(img),
article p:has(img),
article p:has(video) {
    margin: 0 var(--space-block);
}

.img-small article.note p:has(img),
article .callout,
article .code-wrapper,
article blockquote {
    margin: 0 var(--space-block) var(--space-block) var(--space-block);
}

article .content,
.img-content article p:has(img) {
    grid-column: content;
    margin-left: 0;
    margin-right: 0;
}

article .accent,
.img-accent article p:has(img) {
    grid-column: accent;
    margin-left: 0;
    margin-right: 0;
}

.feature article > *,
article .feature,
.img-feature article p:has(img),
article .table-wrapper {
    grid-column: feature;
    margin-left: 0;
    margin-right: 0;
}
.full article > *,
article .full,
.img-max article p:has(img),
.img-full article p:has(img) {
    grid-column: full;
    margin-left: 0;
    margin-right: 0;
}

article.note:not(.portfolio) p:has(img) {
    margin-bottom: var(--space-gap);
}

article .table-wrapper {
    width: 100%;
    overflow-y: hidden;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    position: relative;
}

/* Table gradient overflow indicator */
article .table-wrapper .table-gradient-overlay {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    width: var(--space-xl);
    background: linear-gradient(to left, var(--color-background), transparent);
    pointer-events: none;
    z-index: 3;
    opacity: 0;
    transition: opacity 0.2s ease;
}

article .table-wrapper.has-overflow .table-gradient-overlay {
    opacity: 0.8;
}

/* Enhanced gradient for desktop */
@media (min-width: 769px) {
    article .table-wrapper .table-gradient-overlay {
        width: var(--space-xl);
        opacity: 0;
    }

    article .table-wrapper.has-overflow .table-gradient-overlay {
        opacity: 1;
    }

    article .table-wrapper:hover .table-gradient-overlay {
        opacity: 0;
        transition: opacity 0.2s ease;
    }
}

/* Mobile table gradient overlay */
@media (max-width: 768px) {
    article .table-wrapper.has-overflow .table-gradient-overlay {
        background: linear-gradient(
            to right,
            transparent,
            var(--color-background)
        );
        opacity: 0.8;
    }
}

/* Scroll indicator hint for keyboard users */
article .table-wrapper.has-overflow:focus::before {
    content: "Use ← → arrow keys to scroll";
    position: absolute;
    top: -1.5rem;
    left: 0;
    font-size: var(--scale-xs);
    color: var(--color-muted);
    background: var(--color-background); /* fixed */
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    border: 1px solid var(--color-border);
    white-space: nowrap;
    z-index: 5;
    opacity: 0;
    animation: fadeInUp 0.3s ease forwards;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(0.5rem);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Hide hint on mobile since touch scrolling is natural */
@media (max-width: 768px) {
    article .table-wrapper.has-overflow:focus::before {
        display: none;
    }
}

/* Scrollable table visual cues */
article .table-wrapper.has-overflow {
    cursor: grab;
}

article .table-wrapper.has-overflow:active {
    cursor: grabbing;
}

/* Add subtle fade to table edges when scrollable */
article .table-wrapper.has-overflow::after {
    content: "";
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: 1px;
    background: var(--color-border);
    opacity: 0.3;
    pointer-events: none;
    z-index: 2;
}

/* Table copy button hover styles */
article .table-wrapper:hover .table-copy-button {
    opacity: 1;
}

article .table-wrapper .table-copy-button:hover {
    background: var(--color-background-secondary);
    color: var(--color-foreground);
    transform: scale(1.05);
}

article .table-wrapper table {
    width: fit-content(var(--content-feature));
    border-collapse: collapse;
}

article img,
article audio,
article video {
    margin-inline: auto;
    margin: 0;
    max-width: 100%;
    border-radius: var(--border-radius);
    border: var(--border);
} /* asd */

article h1 {
    margin: var(--space-xl) 0 var(--space-l) 0;
}

article > h1:first-child {
    margin: var(--space) 0 var(--space-xxxl) 0;
}

article h2 {
    margin: var(--space-l) 0 var(--space) 0;
}

article h3,
article h4 {
    margin: var(--space) 0 var(--space) 0;
}

article h5 {
    margin: var(--space) 0 var(--space-s) 0;
}

article h6 {
    margin: var(--space) 0 var(--space-xs) 0;
}

article hr,
article hr:not(:first-child) {
    margin: var(--space) var(--space-xxl) var(--space-xl) var(--space-xxl);
}

article hr + h1,
article hr + h2,
article hr + h3,
article hr + h4,
article hr + h5,
article hr + h6 {
    margin-top: var(--space);
}

article p:has(img) + hr,
article p:has(img) + hr:not(:first-child) {
    margin-top: 0rlh;
}

article p:has(img),
.img-tiny article p:has(img) {
    margin-top: 0;
    margin-bottom: var(--space-gap);
}

article p:has(img) + p:has(img),
article h1 + p:has(img),
article h2 + p:has(img),
article h3 + p:has(img),
article h4 + p:has(img),
article h5 + p:has(img),
article h6 + p:has(img),
article .metadata + p:has(img),
article blockquote + p:has(img),
article hr + p:has(img),
article .code-wrapper + p:has(img),
article .callout + p:has(img),
article h1 + .callout,
article h2 + .callout,
article h3 + .callout,
article h4 + .callout,
article h5 + .callout,
article h6 + .callout,
article hr + .callout,
article .table-wrapper + .callout {
    margin-top: 0 !important;
}
article .code-wrapper + .code-wrapper,
article .callout + .callout {
    margin-top: calc(var(--space) * -1) !important;
}

article .metadata {
    margin-bottom: 0 !important;
}

article p:has(img) + p:not(:has(img)),
article p:has(img) + div,
article p:has(img) + blockquote,
article p:has(img) + hr,
article p:has(img) + .code-wrapper {
    margin-top: calc(var(--space) + var(--space-s)) !important;
}

/* zzz
article blockquote + p:has(img),
article .code-wrapper + p:has(img),
article .callout + p:has(img),
article blockquote + p,
article .callout + p,
article .code-wrapper + p,
article .mermaid + p {
    margin-top: calc(var(--space) * 1);
}
*/

// ==========================
// Mermaid Block
// ==========================

article .mermaid {
    margin: 0 auto var(--space) auto;
    padding: var(--space);
}

// ==========================
// IMG Block
// ==========================
article p img {
    max-width: 100%;
}

// ==========================
// BLOCKQUOTE
// ==========================
article blockquote {
    font-size: var(--scale-s);
    line-height: var(--font-density-s);
    padding: var(--space);
    font-style: italic;
}

// ==========================
// CALLOUT
// ==========================
article .callout {
    line-height: var(--font-density-s);
    transition: var(--duration-superfast) var(--motion-smooth);
    padding: var(--space-xxs);
}
article .callout-title-icon {
    display: none;
}
article .callout-title {
    font-size: var(--scale-s);
    user-select: none;
    font-weight: bold;
    padding: var(--space-xxxs) calc(var(--space) - var(--space-xs))
        var(--space-xxxs) calc(var(--space) - var(--space-xs));
}
article .callout img {
    margin-left: 0;
    margin-right: 0;
}

article .callout-content {
    font-size: var(--scale-s);
    overflow: hidden;
    border-radius: var(--border-radius);
    padding: var(--space-s) calc(var(--space) - var(--space-xs));
    margin-top: var(--space-xxs);
    margin-left: 0;
    border: var(--border);
    text-align: left;
}
article .callout .callout-content p:first-child {
    margin-top: 0;
}
article .callout .callout-content ul,
article .callout .callout-content ol {
    padding: 0 calc(var(--space) * 0.75);
}
article .callout .callout-content .code-wrapper {
    margin: var(--space) 0;
}
article .callout .callout-content > .callout {
    margin: calc(var(--space-xs) * -1);
}
article .callout .callout-content > .callout .callout-content {
    padding: var(--space-s);
}
article .callout .callout-content > .callout .callout-title {
    padding-left: var(--space-s);
    padding-right: var(--space-s);
}
/*
.callout-content:has(> p:empty):not(:has(.callout)) {
    display: none;
}
}*/
article details > summary {
    list-style: none; /* removes marker in Firefox */
}

article details .callout-title::before {
    content: "▸";
    display: inline-block;
    transform: rotate(0deg);
    transition: transform 0.2s ease;
}
article details[open] .callout-title::before {
    transform: rotate(90deg);
}
article details .callout-title-inner {
    display: inline;
}

article p:has(img) + .callout[data-callout="caption" i] {
    padding: 0;
    background: none;
    border: none;
    margin: 0 var(--space-l);
    position: relative;
    top: calc(var(--space) * -1.75);
    box-shadow: none;
}
article p:has(img) + .callout[data-callout="caption" i] .callout-title {
    display: none;
}
article p:has(img) + .callout[data-callout="caption" i] .callout-content {
    padding: 0;
    background: none;
    border: none;
    box-shadow: none;
    line-height: 1;
    text-align: center !important;
    text-wrap: balance !important;
}

article .table-wrapper {
    margin: var(--space-l) auto var(--space-xl) auto;
}
article .table-wrapper + .callout,
article .table-wrapper + p:has(img),
article .table-wrapper + blockquote,
article .table-wrapper + .code-wrapper {
    margin-top: 0;
}

// ==========================
// PRE
// ==========================
article pre {
    margin: 0;
    padding: var(--space);
}
article .code-wrapper,
article .code-wrapper:first-child,
article .code-wrapper:last-child {
    margin: var(--space) var(--space-l) var(--space-l) var(--space-l);
    font-size: var(--scale-s);
    line-height: var(--font-density-s);
    overflow-x: auto;
    white-space: pre;
    word-wrap: normal;
    word-break: keep-all;
}
article .code-wrapper + .callout,
article .code-wrapper + p:has(img),
article .code-wrapper + blockquote,
article .code-wrapper + .table-wrapper {
    margin-top: 0;
}

// ==========================
// Inline code styling
// ==========================
:not(pre) > code {
    background-color: var(--color-background-secondary);
    border: 0;
    border-radius: var(--border-radius);
    line-height: var(--font-density-s);
    margin: 0;
    padding: 0.1em 0.3em;
    font-size: var(--scale-s);
    white-space: normal;
    text-wrap: wrap;
}

/* -= List =- */
.nobullet {
    list-style: none;
    padding-left: 0;
}
.nobullet li::before {
    content: "";
    margin-left: 0;
}

article ul:not([start]),
article ul,
article ol:not([start]),
article ol {
    list-style: none;
    list-style-position: outside;
    padding: 0 var(--space-l);
    break-inside: avoid;
    page-break-inside: avoid;
    -webkit-column-break-inside: avoid;
    counter-reset: ol-counter;
}

article ul ul,
article ol ol,
article ul ol,
article ol ul {
    padding-left: calc(
        var(--space) * 1
    ) !important; /* or whatever deeper value you want */

    li {
        margin-bottom: 0;
    }
}
article li > p {
    display: inline;
}
article li {
    line-height: 1.3;
    margin-bottom: 0;
    margin-left: 0;
}
article ul > li::before {
    content: "\2022";
    display: inline-block;
    text-align: center;
    width: var(--space);
    opacity: 0.25;
    margin-left: calc(var(--space) * -1);
}

article ol > li::before,
article ol:not([start]) > li::before {
    display: inline-block;
    width: var(--space);
    opacity: 0.25;

    content: counter(ol-counter) ". ";
    font-variant-numeric: tabular-nums;
    position: absolute;
    left: calc(var(--space) * -1.5);
    text-align: right;
    --space: unset;
}
article ol > li:not(:last-child),
article ul > li:not(:last-child) {
    margin-bottom: var(--space-xs);
}

article li > p + ul,
article li > p + ol {
    margin-top: calc(var(--space-s) * -1);
}
li > p + ul,
li > p + ol {
    /* like above but for lists inside compact lists */
    margin-top: calc(var(--blockSpacingBottom) * -1);
}

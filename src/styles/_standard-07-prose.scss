@use "standard-00-variables" as *;

/**
 * @component Prose Layout System
 * @category Layout
 * @description Prose-focused layout system for optimal reading experience with proper
 * line lengths based on typography research (60-75 characters). Uses CSS Grid with
 * responsive content columns for sidebars, accents, and featured content.
 * Inspired by fine-art typography and classical book design principles.
 *
 * @prop {class} .prose Main article/content container for readable prose
 * @prop {class} .small Narrow sidebar width container
 * @prop {class} .accent Accent container with background color
 * @prop {class} .feature Featured content with larger spacing
 * @prop {class} .hero Full-width container
 * @prop {variable} --line-width-xs Extra small (24rem / 384px)
 * @prop {variable} --line-width-s Small (32rem / 512px)
 * @prop {variable} --line-width-m Medium (42rem / 672px) - default
 * @prop {variable} --line-width-l Large (50rem / 800px)
 * @prop {variable} --line-width-xl Extra large (60rem / 960px)
 *
 * @example
 * // Standard article with proper reading width
 * <article class="prose">
 *   <h1>Article Title</h1>
 *   <p>Content here stays within optimal reading width...</p>
 * </article>
 *
 * // Narrow sidebar content
 * <div class="prose small">
 *   <p>Short form content</p>
 * </div>
 *
 * // Featured content with emphasis
 * <section class="prose feature">
 *   <blockquote>Important quote with extra space</blockquote>
 * </section>
 *
 * @since 0.1.0
 * @see https://www.rsub.com/blog/how-long-should-a-line-of-text-be/
 */

/* Prose Layout Design Tokens - Using logical properties */
:root {
    /* Layout grid tokens */
    --gap: clamp(var(--rhythm), 6%, var(--rhythm-3));
    --content: min(var(--line-width), 100% - var(--gap) * 2); /* â† FIXED */
    --content-small: var(--rhythm-gap-block);
    --content-accent: minmax(0, var(--rhythm-2));
    --content-feature: minmax(0, var(--rhythm-4));
    --content-hero: minmax(0, 1fr);
}

@media (max-width: #{$small}) {
    :root {
        --gap: 0;
    }
}

/* Prose Layout System - Article content grid and positioning */
/* Inspired by fine-art typography and book design principles */

:where(.prose) {
    display: grid;
    grid-template-columns:
        [hero-start] var(--content-hero)
        [feature-start] var(--content-feature)
        [accent-start] var(--content-accent)
        [content-start] var(--content) [content-end]
        var(--content-accent) [accent-end]
        var(--content-feature) [feature-end]
        var(--content-hero) [hero-end];

    transition: grid-template-columns 0.3s ease-out;

    position: relative;
    z-index: var(--z-base);
    /* Default content positioning */
    > * {
        grid-column: content;
    }

    .container-small {
        grid-column: content;
        margin-inline: var(--content-small);
    }

    table,
    .scroll:has(table),
    .container-accent {
        grid-column: accent;
        margin-inline: 0;
    }

    .container-feature {
        grid-column: feature;
        margin-inline: 0;
    }

    .container-hero {
        grid-column: hero;
        margin-inline: calc((var(--rhythm) * var(--body-padding)) * -1);
        /*padding-inline: var(--body-padding);*/
        > * {
            margin-inline: 0;
        }
    }

    /* Image gallery layout */
    &:not(.no-grid) {
        p:has(img) {
            display: flex;
            --gap: var(--rhythm-d4);
            gap: var(--gap);
            border-radius: var(--border-radius);
        }

        p:has(img) > * {
            flex: 1 1 auto;
            min-width: 1%;
            min-height: 1%;
            object-fit: cover;
        }

        p:has(img) img {
            flex-grow: 0; /* prevents the image from stretching to fill */
        }

        p:has(video) > * {
            flex: 1 1 auto;
            min-width: 1%;
            min-height: 1%;
            object-fit: cover;
        }

        p:has(img) img,
        p:has(img) img:first-child,
        p:has(img) img:last-child {
            margin-inline: auto;
        }

        p:has(img) br {
            display: none;
        }

        .callout p:has(img),
        .callout p:has(img) br {
            display: block;
        }

        /* Adjacent images get reduced spacing */
        p:has(img) + p:has(img) {
            margin-block-start: calc(
                (var(--rhythm) * -1) + var(--gap)
            ) !important;
        }
    }

    @media only screen and (max-width: #{$small}) {
        p:has(img) {
            display: block;
        }
    }

    h1,
    > h1:where(:first-child) {
        margin-block-start: var(--rhythm-5);
        margin-block-end: var(--rhythm-gap-block);
    }

    h2 {
        margin-block-start: var(--rhythm-4);
        margin-block-end: var(--rhythm-gap);
    }

    h3 {
        margin-block-start: var(--rhythm-gap);
    }

    h4 {
        margin-block-start: var(--rhythm-gap);
    }

    h5 {
        margin-block-start: var(--rhythm);
        margin-block-end: var(--rhythm-gap);
    }

    h6 {
        margin-block-start: var(--rhythm);
        margin-block-end: var(--rhythm-d3);
    }

    hr {
        margin-inline: calc(var(--rhythm-2) * var(--rhythm-gap));
    }

    /* because it bugged with image gallery
    :is(#{$rhythm-block-elements}):has(+ :is(#{$rhythm-block-elements})) {
        margin-block-end: calc(var(--rhythm-gap-block) - var(--rhythm-gap));
    }
    */

    :where(#{$rhythm-block-elements}) {
        > :is(h1, h2, h3, h4, h5, h6):where(:first-child) {
            margin-block-start: 0; /* No top margin */
            /* Keep the heading's natural bottom margin */
        }
    }

    /* Note: Page's main title h1:first-child retains spacing via direct child selector */
    /* The > h1:first-child selector in h1 rule ensures it overrides rhythm's > * margin-reset */

    /* Basic media styling */
    img,
    audio,
    video {
        margin: 0;
        margin-inline: auto;
        max-inline-size: 100%;
        border-radius: var(--border-radius);
        border: var(--border);
    }

    .callout,
    blockquote,
    pre,
    figure,
    p:has(img) {
        margin-inline: var(--content-small);
    }
    @media (max-width: #{$mobile}) {
        .container-small,
        .callout,
        blockquote,
        pre,
        figure,
        p:has(img) {
            margin-inline: 0;
        }
    }

    /* Mermaid diagrams */
    .mermaid {
        margin-block-end: var(--rhythm);
        margin-inline: auto;
        padding: var(--rhythm);
    }

    p img {
        max-inline-size: 100%;
    }
}

/* Animation keyframes */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(0.5rem);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

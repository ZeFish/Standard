---
import Base from "../astro/layouts/Base.astro";
import config from "virtual:standard/config";

// This function generates all the static paths for our .md files
export async function getStaticPaths() {
    // Import all .md files from the content directory
    const pages = import.meta.glob("/content/**/*.md", { eager: true });

    // Convert file paths to URL slugs
    return Object.keys(pages).map((path) => {
        // Remove /content/ prefix and .md extension
        const slug = path.replace("/content/", "").replace(".md", "");

        // Handle index files (content/index.md becomes just /)
        const urlPath = slug.endsWith("/index")
            ? slug.replace("/index", "")
            : slug;

        // Empty string/undefined for index file (/) - this becomes the root route
        return {
            params: { slug: urlPath || undefined },
            props: {
                page: pages[path],
                path,
            },
        };
    });
}

// Get the page data from props
const { page, path } = Astro.props;
const { Content, frontmatter } = page;

// âœ¨ NEW: Merge backlinks from file.data into frontmatter for Base layout
const frontmatterWithBacklinks = {
    ...frontmatter,
    backlinks: frontmatter?.backlinks || {},
};
---

<!-- Use Base layout and pass the markdown content through -->
<Base
    frontmatter={frontmatterWithBacklinks}
    title={frontmatter?.title || "Standard Framework"}
    description={frontmatter?.description || config.description}
    class="prose"
>
    <Content />
</Base>

---
import Meta from "./Meta.astro";
import Fonts from "../components/Fonts.astro";
import Menu from "../components/Menu.astro";
import Comments from "../components/Comments.astro";
import Lab from "../components/Lab.astro";

// Import site configuration from virtual module
import config from "virtual:standard/config";

// Use config from virtual module, with fallback to props for backward compatibility
const {
    frontmatter,
    site = config, // Use config as default, allow override via props
    title = frontmatter?.title || config.title,
    description = frontmatter?.description || config.description,
    image = frontmatter?.image,
    created = frontmatter?.created,
    modified = frontmatter?.modified,
    tags = frontmatter?.tags,
    securityHeaders = frontmatter?.securityHeaders,
    class: className,
} = Astro.props;

const year = new Date().getFullYear();

// HTMX attributes for progressive enhancement
const htmxAttributes = {
    "hx-boost": "true",
    "hx-ext": "preload",
    "hx-target": "body",
    "hx-swap": "innerHTML scroll:window:top",
};
---

<!doctype html>
<html
    class="rhythm"
    lang={site.language || "en"}
    data-standard-version={site.standard?.version}
    data-theme="default"
>
    <head>
        <Meta
            site={site}
            title={title}
            description={description}
            image={image}
            created={created}
            modified={modified}
            tags={tags}
            securityHeaders={securityHeaders}
        />
        <Fonts />
        <Lab />

        <!-- Load HTMX library -->
        <script src="https://unpkg.com/htmx.org@1.9.10"></script>

        <link rel="stylesheet" href="https://use.typekit.net/epz8pgr.css" />

    </head>

    <body {...htmxAttributes} class={className}>
        <a href="#main" class="skip-link">Skip to content</a>

        <header
            class="flex font-interface"
            style="justify-content: space-between; max-width: 100%;"
        >
            <p>
                <a href="/" style="text-decoration: none;"
                    >{site.title || config.title}</a
                >
            </p>
            <Menu
                items={site.nav?.header || config.nav?.header}
                class="horizontal"
            />
        </header>

        <main id="main" class="prose">
            <slot />

            <Comments />
        </main>

        <hr />

        <footer class="smaller font-interface">
            <p>
                © {year}
                {site.author?.name || site.author || config.author?.name} ·
                <a href="/">{site.title || config.title}</a> ·
                <a
                    href="https://github.com/ZeFish/Standard/blob/main/LICENSE"
                    class="external-link">MIT License</a
                >
            </p>
        </footer>
    </body>
</html>

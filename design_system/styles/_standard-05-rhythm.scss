@use "standard-00-variables" as *;

/**
 * @component Vertical Rhythm System
 * @category Layout
 * @description Enhanced bulletproof rhythm system that prevents margin collapse
 * and ensures consistent vertical spacing throughout the document. Based on the
 * 1rlh (relative line height) rhythm unit for mathematical precision.
 * Applied globally to <html> root for cascade throughout the page.
 * Supports responsive rhythm adjustments and granular control per element.
 *
 * @prop {class} .rhythm Apply rhythm spacing to <html> root or any container
 * @prop {class} .no-rhythm Disable rhythm for specific elements
 * @prop {variable} --base Base rhythm unit (1rlh)
 * @prop {variable} --base-gap Normal element spacing multiplier (default: 1)
 * @prop {variable} --base-block-gap Block element spacing multiplier
 * @prop {variable} --body-padding Padding multiplier for <body> (desktop)
 * @prop {variable} --body-mobile-padding-multiplier Padding multiplier for <body> (mobile)
 *
 * @example
 * // Global: <html> has .rhythm class (applied automatically)
 * <html class="rhythm">
 *   <body>
 *     <!-- All content gets rhythm spacing -->
 *     <h1>Title</h1>
 *     <p>Paragraphs get automatic spacing</p>
 *   </body>
 * </html>
 *
 * // Local: Apply .rhythm to specific container
 * <div class="rhythm">
 *   <h1>Section Title</h1>
 *   <p>Container children get rhythm spacing</p>
 * </div>
 *
 * // Disable: Use .no-rhythm to opt-out
 * <section class="no-rhythm">No spacing applied here</section>
 * <div class="rhythm no-rhythm">Explicitly disabled rhythm</div>
 *
 * @since 0.1.0
 * @see standard-01-token.scss
 * @see standard-06-reading.scss




 --rhythm-gap -> little xtra control here
 */

/* ===== BULLETPROOF RHYTHM SYSTEM ===== */
/* Applied to <html> root for global cascade (best practice for frameworks) */
:where(.rhythm) {
  /* Rhythm control - can be overridden per instance */
  display: inline-flex;
  align-items: baseline;
  display: flow-root;

  * {
    margin: 0;
    vertical-align: baseline;
    margin-block-start: 0;
    margin-block-end: var(--rhythm-gap, calc(var(--space) + var(--space-half)));
  }

  p:has(+ p) {
    margin-block-end: var(
      --rhythm-gap-p,
      var(--rhythm-gap, calc(var(--space) + var(--space-half)))
    );
  }

  p:has(+ :is(h1, h2, h3, h4, h5, h6)) {
    margin-block-end: 0;
  }

  section {
    margin-block-end: var(--space-6);
  }
  section.container-hero {
    padding-block: var(--space-2);
    border-top: var(--border);
    border-bottom: var(--border);
    box-shadow: var(--shadow);
    p {
      max-width: var(--line-width);
      margin-inline: auto !important;
    }
  }

  /*

  Le leading pouse le text qui touchais la ligne du dessus, a la ligne du .compact
  p + p {
    margin-block-start: var(--space-half-negative);
  }

  */

  /* Padding only applied to <body> when rhythm is active */
  > body {
    margin: 0;
    padding: var(--gap-body);
    padding-bottom: calc(var(--gap-body) * 1.5);

    [id] {
      scroll-margin-top: calc(var(--space-2) + var(--gap-body));
      /* Adjust value as needed */
    }
  }

  /* Elements within rhythm containers */
  /* Enhanced spacing relationships for typography
  #{$rhythm-elements} {
    margin-block-start: 0;
    margin-block-end: var(--space);
  }*/

  /* Special blocks get generous spacing (2Ã— rhythm) */
  /* Layout containers get double spacing for emphasis
  #{$rhythm-block-elements} {
    margin-block-start: max(calc(var(--space-2); - var(--space)), var(--space));
    margin-block-end: max(var(--space-2) var(--space));
  }*/

  /* The i that two specal block would bit a bit closer
    debug when  its image
  :is(#{$rhythm-block-elements}):has(+ :is(#{$rhythm-block-elements})) {
    margin-block-end: var(--space);
  }

  :is(#{$rhythm-block-elements}) + :is(#{$rhythm-block-elements}) {
    margin-block-start: max(0, var(--space));
  }*/

  /* Reset first-child spacing for special blocks */
  :is(.card, aside, blockquote, pre, figure, .callout-content) > :first-child {
    margin-block-start: 0;
  }

  * > :last-child {
    margin-block-end: 0;
  }

  .rhythm {
    --base-gap: 1;
    /* Reset for nested contexts */
  }

  h1 {
    margin-block-start: var(--space-4);
    margin-block-end: calc(var(--space-2) + var(--space-half));
  }

  h1:first-of-type {
    margin-block-start: var(--space-4);
    margin-block-end: calc(var(--space-6) + var(--space-half));
  }

  h2,
  h3 {
    margin-block-start: var(--space-3);
    margin-block-end: calc(var(--space) + var(--space-half));
  }

  h4,
  h5,
  h6 {
    margin-block-start: calc(var(--space-2) + var(--space-half));
    margin-block-end: var(--space-half);
  }

  :is(h1, h2, h3) + :is(h1, h2, h3),
  hr + :is(h1, h2, h3) {
    margin-block-start: 0;
  }

  hr {
    margin-inline: calc(var(--space-4));
    margin-block-start: max(
      calc((var(--space-2) - var(--space)) * 1),
      var(--space)
    );
    margin-block-end: max((var(--space-2) * 1), var(--space));
  }
}

/* Individual element overrides */
.no-rhythm {
  margin: 0 !important;
}

/**
 * Standard Framework - Main Entry Point
 *
 * This file serves as both:
 * 1. An ES module entry point for direct imports (for bundlers like Astro)
 * 2. A distributed UMD/IIFE export for npm consumers
 *
 * When distributed as @zefish/standard/js, this becomes dist/standard.min.js
 * (via build-js.js bundling all modules together).
 *
 * Usage:
 *   // In Astro or modern bundler
 *   import standard from '@zefish/standard';
 *
 *   // Or import specific parts
 *   import { toast, comments, ImageZoom } from '@zefish/standard';
 *
 * @version @VERSION_PLACEHOLDER@
 */

// Re-export all public APIs from individual modules
export { default as toast } from "./standard.toast.js";
export { default as comments, GitHubComments } from "./standard.comment.js";
export { ImageZoom, default as imageZoom } from "./standard-image-zoom.js";
export { initCopyButtons } from "./standard-copy-buttons.js";
export { initializeScrollWrappers } from "./standard-scroll-wrappers.js";
export { initHTMX } from "./standard-htmx.js";
export { initAstro } from "./standard-astro.js";

/**
 * Main namespace object
 */
const standard = {
  version: "@VERSION_PLACEHOLDER@",

  getInstance(moduleName) {
    if (typeof window === "undefined") return null;
    switch (moduleName) {
      case "toast":
        return window.toast || null;
      case "comments":
        return window.comments || null;
      case "imageZoom":
        return window.imageZoom || null;
      default:
        console.warn(
          `Unknown module: ${moduleName}. Available: toast, comments, imageZoom`,
        );
        return null;
    }
  },

  getInstances() {
    if (typeof window === "undefined") {
      return { toast: null, comments: null, imageZoom: null };
    }
    return {
      toast: window.toast || null,
      comments: window.comments || null,
      imageZoom: window.imageZoom || null,
    };
  },

  detectFramework() {
    if (typeof window === "undefined") return "none";
    if (window.astro) return "astro";
    if (window.htmx) return "htmx";
    return "none";
  },

  info() {
    const framework = this.detectFramework();
    console.log(`Standard Framework v${this.version}`);
    console.log(`Framework detected: ${framework}`);
    console.log("Modules:", [
      "toast - Notification system",
      "comments - GitHub-backed comments",
      "imageZoom - Click-to-zoom lightbox",
      "initCopyButtons() - Copy buttons for code blocks",
      "initializeScrollWrappers() - Scroll shadows",
    ]);
    console.log("Integrations:", [
      "initHTMX() - For HTMX navigation",
      "initAstro() - For Astro View Transitions",
    ]);
  },
};

export default standard;

// Expose to global scope
if (typeof window !== "undefined") {
  window.standard = standard;
  console.log(
    "Standard Framework loaded. Type window.standard.info() for help.",
  );
}

export{default as toast}from"./standard.toast.js";export{default as comments,GitHubComments}from"./standard.comment.js";export{StandardLab}from"./standard.lab.js";export{ImageZoom,default as imageZoom}from"./standard.image-zoom.js";export{initCopyButtons}from"./standard.copy-buttons.js";export{initScrollWrappers}from"./standard.scroll-wrappers.js";export{initAstro,astroHelpers}from"./standard.astro.js";export{initHTMX}from"./standard.htmx.js";import{default as imageZoom}from"./standard.image-zoom.js";import{initCopyButtons}from"./standard.copy-buttons.js";import{initScrollWrappers}from"./standard.scroll-wrappers.js";const standard={version:"@VERSION_PLACEHOLDER@",getInstance(t){if("undefined"==typeof window)return null;switch(t){case"toast":return window.toast||null;case"comments":return window.comments||null;case"StandardLab":return window.StandardLab||null;case"imageZoom":return window.imageZoom||null;default:return console.warn(`Unknown module: ${t}. Available: toast, comments, StandardLab, imageZoom`),null}},getInstances:()=>"undefined"==typeof window?{toast:null,comments:null,StandardLab:null,imageZoom:null}:{toast:window.toast||null,comments:window.comments||null,StandardLab:window.StandardLab||null,imageZoom:window.imageZoom||null},detectFramework:()=>"undefined"==typeof window?"none":window.startViewTransition?"astro-view-transitions":window.astro?"astro":window.htmx?"htmx (deprecated)":"none",refresh(){"undefined"!=typeof window&&(window.imageZoom&&"function"==typeof window.imageZoom.rescan&&window.imageZoom.rescan(),"function"==typeof initCopyButtons&&initCopyButtons(),"function"==typeof initScrollWrappers&&initScrollWrappers())},init(){"undefined"!=typeof window&&(this.refresh(),document.addEventListener("astro:page-load",()=>{this.refresh()}),document.body.addEventListener("htmx:afterSettle",()=>{this.refresh()}))},info(){const t=this.detectFramework();console.log(`Standard Framework v${this.version}`),console.log(`Framework detected: ${t}`),console.log("Modules:",["toast - Notification system","comments - GitHub-backed comments","StandardLab - Design token inspector","imageZoom - Click-to-zoom lightbox","initCopyButtons() - Copy buttons for code blocks","initScrollWrappers() - Scroll shadows"]),console.log("Integrations:",["âœ“ initAstro() - For Astro View Transitions API (recommended)","âš  initHTMX() - For HTMX navigation (legacy, use View Transitions instead)"]),console.log("\nðŸ“š Learn more:"),console.log("  Astro View Transitions: https://docs.astro.build/en/guides/view-transitions/")}};export default standard;"undefined"!=typeof window&&(window.standard=standard,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>standard.init()):standard.init(),console.log("Standard Framework loaded. Type window.standard.info() for help."));const TOAST_DEFAULTS={duration:4e3,position:"top-center",pauseOnHover:!0,showProgress:!0,closeButton:!1,maxToasts:5,animation:"slide",role:"status"},toastContainers={};let toastNotificationQueue=[],activeToastCount=0;function getContainer(t){if(toastContainers[t])return toastContainers[t];const e=document.createElement("div");return e.className=`toast-container toast-container-${t}`,e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","false"),document.body.appendChild(e),toastContainers[t]=e,e}function createToast(t,e,n){const a=document.createElement("div");a.className=`toast toast-${e}`,a.setAttribute("role",n.role);const o=document.createElement("div");o.className="toast-content";const r=document.createElement("span");r.className="toast-icon",r.setAttribute("aria-hidden","true"),r.textContent=getIcon(e);const s=document.createElement("div");if(s.className="toast-message",s.textContent=t,o.appendChild(r),o.appendChild(s),n.closeButton){const t=document.createElement("button");t.className="toast-close",t.setAttribute("aria-label","Close notification"),t.innerHTML="Ã—",t.addEventListener("click",()=>dismissToast(a)),o.appendChild(t)}if(a.appendChild(o),n.showProgress&&n.duration>0){const t=document.createElement("div");t.className="toast-progress",a.appendChild(t),a._progressBar=t}return a}function getIcon(t){return{success:"âœ“",error:"âœ•",warning:"âš ",info:"â„¹"}[t]||"â„¹"}function showToast(t,e="info",n={}){const a={...TOAST_DEFAULTS,...n};if(activeToastCount>=a.maxToasts)return void toastNotificationQueue.push({message:t,type:e,options:a});const o=getContainer(a.position),r=createToast(t,e,a);let s,i;o.appendChild(r),activeToastCount++,r.offsetHeight,requestAnimationFrame(()=>{r.classList.add("toast-visible")});let d=a.duration;function l(){a.duration<=0||(i=Date.now(),s=setTimeout(()=>{dismissToast(r)},d),r._progressBar&&(r._progressBar.style.transition=`width ${d}ms linear`,r._progressBar.style.width="0%"))}a.pauseOnHover&&(r.addEventListener("mouseenter",function(){if(!(a.duration<=0)&&(clearTimeout(s),d-=Date.now()-i,r._progressBar)){const t=window.getComputedStyle(r._progressBar);r._progressBar.style.width=t.width,r._progressBar.style.transition="none"}}),r.addEventListener("mouseleave",l)),l();const c=t=>{"Escape"===t.key&&dismissToast(r)};return document.addEventListener("keydown",c),r._escapeHandler=c,r}function dismissToast(t){t.classList.remove("toast-visible"),t.classList.add("toast-dismissing"),setTimeout(()=>{if(t.parentNode&&t.parentNode.removeChild(t),t._escapeHandler&&document.removeEventListener("keydown",t._escapeHandler),activeToastCount--,toastNotificationQueue.length>0){const t=toastNotificationQueue.shift();showToast(t.message,t.type,t.options)}},300)}const toast={success:(t,e={})=>showToast(t,"success",e),error:(t,e={})=>showToast(t,"error",{...e,role:"alert"}),warning:(t,e={})=>showToast(t,"warning",e),info:(t,e={})=>showToast(t,"info",e),show:(t,e="info",n={})=>showToast(t,e,n),dismissAll(){Object.values(toastContainers).forEach(t=>{t.querySelectorAll(".toast").forEach(dismissToast)}),toastNotificationQueue=[]},configure(t){Object.assign(TOAST_DEFAULTS,t)}};export default toast;
/**
 * Image Zoom - Standalone lightbox with keyboard navigation
 *
 * A lightweight image zoom library with full featured lightbox experience.
 * Click any image to zoom, use arrow keys to navigate, ESC to close.
 *
 * Features:
 * - Click to zoom in/out
 * - Keyboard navigation (â†/â†’ arrows, ESC to close)
 * - Click backdrop to close
 * - Auto-closes on scroll
 * - Wraps around image gallery
 * - Custom events for extensibility
 * - Configurable selectors
 * - Graceful degradation (CSS fallback without JS)
 * - HTMX compatible via rescan() method
 *
 * @version @VERSION_PLACEHOLDER@
 * @license MIT
 */export class ImageZoom{constructor(t={}){this.options={selector:"img:not([data-no-zoom])",enableKeyboardNav:!0,...t},this.overlay=null,this.originalImage=null,this.images=[],this.boundKeydownHandler=this.handleKeydown.bind(this),this.boundCloseHandler=this.close.bind(this),this.boundClickHandler=this.handleClick.bind(this),this.init()}init(){document.documentElement.classList.add("js-image-zoom-enabled"),document.addEventListener("click",this.boundClickHandler),console.log("[ImageZoom] Initialized and click listener attached")}rescan(){return this.refreshImages(),document.documentElement.classList.add("js-image-zoom-enabled"),document.removeEventListener("click",this.boundClickHandler),document.addEventListener("click",this.boundClickHandler),console.log(`[ImageZoom] Rescanned. Found ${this.images.length} images. Listener rebound.`),this.images.length}refreshImages(){return this.images=Array.from(document.querySelectorAll(this.options.selector)),this.images.length}handleClick(t){const e=t.target.closest(this.options.selector);e?(console.log("[ImageZoom] Click detected on zoomable image",e),this.overlay?(t.preventDefault(),this.close()):(t.preventDefault(),t.stopPropagation(),this.open(e))):this.overlay&&(t.preventDefault(),this.close())}handleKeydown(t){if(this.overlay)switch(t.key){case"Escape":t.preventDefault(),this.close();break;case"ArrowLeft":case"ArrowUp":t.preventDefault(),this.navigate(-1);break;case"ArrowRight":case"ArrowDown":t.preventDefault(),this.navigate(1)}}open(t){if(this.overlay)return;this.originalImage=t,this.overlay=document.createElement("div"),this.overlay.className="image-zoom-overlay";const e=new Image;e.src=this.originalImage.src,e.alt=this.originalImage.alt,this.overlay.appendChild(e),document.body.appendChild(this.overlay),document.documentElement.classList.add("image-zoomed-active"),this.options.enableKeyboardNav&&document.addEventListener("keydown",this.boundKeydownHandler),window.addEventListener("scroll",this.boundCloseHandler),requestAnimationFrame(()=>{this.overlay.classList.add("is-visible")})}close(){this.overlay&&(window.removeEventListener("scroll",this.boundCloseHandler),this.overlay.classList.remove("is-visible"),this.overlay.addEventListener("transitionend",()=>{this.overlay&&(this.overlay.remove(),this.overlay=null)},{once:!0}),document.documentElement.classList.remove("image-zoomed-active"),this.originalImage=null,this.options.enableKeyboardNav&&document.removeEventListener("keydown",this.boundKeydownHandler))}navigate(t){if(!this.originalImage)return;this.images=Array.from(document.querySelectorAll(this.options.selector));const e=this.images.indexOf(this.originalImage);if(-1===e)return;const n=(e+t+this.images.length)%this.images.length,a=this.images[n];if(a){const t=this.overlay.querySelector("img");t.src=a.src,t.alt=a.alt,this.originalImage=a}}destroy(){this.overlay&&this.close(),document.removeEventListener("click",this.boundClickHandler)}}if("undefined"!=typeof window){window.ImageZoom=ImageZoom;const t=()=>{window.imageZoom=new ImageZoom};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}export default ImageZoom;export function initScrollWrappers(t=document){t.querySelectorAll(".scroll:not([data-scroll-initialized])").forEach(t=>{const e=()=>{if(!(t.scrollWidth>t.clientWidth))return void t.classList.remove("show-left-shadow","show-right-shadow");const e=t.scrollLeft,n=t.scrollWidth-t.clientWidth;t.classList.toggle("show-right-shadow",0===e),t.classList.toggle("show-left-shadow",e>=n-1)};e(),t.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",e),t.dataset.scrollInitialized="true"})}"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{initScrollWrappers(document)}):initScrollWrappers(document)),"undefined"!=typeof window&&(window.initializeScrollWrappers=initScrollWrappers);export function initCopyButtons(){navigator.clipboard?document.querySelectorAll("pre > code").forEach(t=>{if(t.parentNode.querySelector(".copy-button"))return;const e=document.createElement("button");e.className="copy-button",e.textContent="Copy",e.setAttribute("aria-label","Copy code to clipboard"),e.onclick=async()=>{try{await navigator.clipboard.writeText(t.innerText),e.textContent="Copied!",e.classList.add("copied"),setTimeout(()=>{e.textContent="Copy",e.classList.remove("copied")},2e3)}catch(t){console.error("Failed to copy:",t),e.textContent="Failed",setTimeout(()=>{e.textContent="Copy"},2e3)}},t.parentNode.append(e)}):console.warn("Clipboard API not available (requires HTTPS)")}"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",initCopyButtons):initCopyButtons()),"undefined"!=typeof window&&(window.initCopyButtons=initCopyButtons)
/*!
 * Standard System Inspector - Minimal Debug Interface
 *
 * A minimalist debug interface for the Standard Framework
 * Philosophy: Felt, not seen. Present when needed, invisible when not.
 *
 * HTMX-COMPATIBLE VERSION: Includes a .refresh() method and stable IDs
 * to work with htmx:load events and hx-preserve.
 *
 * @version @VERSION_PLACEHOLDER@
 */;class StandardLab{constructor(){this.state="dormant",this.badge=null,this.panel=null,this.currentTab="typography",this.googleFontsLoaded=new Set,this.colorScheme=this.detectColorScheme(),this.modifiedTokens=new Set,this.position=this.loadPosition(),this.version=document.documentElement.dataset.standardVersion,this.customThemes=[],this.sliderConfig={"--optical-ratio":{min:1,max:2,step:.01,unit:""},"--line-height":{min:1,max:2,step:.05,unit:""},"--font-size":{min:0,max:2,step:.05,unit:"em"},"--ratio-golden":{min:1,max:2,step:.01,unit:""},"--ratio-silver":{min:1,max:3,step:.01,unit:""},"--ratio-wholestep":{min:1,max:3,step:.01,unit:""},"--ratio-halfstep":{min:1,max:2,step:.01,unit:""},"--font-weight":{min:100,max:900,step:100,unit:""},"--bold-weight":{min:100,max:900,step:100,unit:""},"--radius":{min:0,max:2,step:.05,unit:"rem"},"--line-width":{min:0,max:10,step:.5,unit:"px"},"--base":{min:.5,max:3,step:.05,unit:"rem"},"--base-gap":{min:0,max:3,step:.05,unit:"rem"},"--base-block-gap":{min:0,max:3,step:.05,unit:"rem"},"--body-padding":{min:0,max:5,step:.25,unit:"rem"},"--gap":{min:0,max:3,step:.05,unit:"rem"},"--grid-gap":{min:0,max:3,step:.05,unit:"rem"}},this.coreTokens={typography:["--font-text","--font-header","--font-monospace","--font-interface","--font-size","--optical-ratio","--line-height","--font-weight","--bold-weight","--font-letter-spacing","--font-header-letter-spacing","--font-header-weight"],layout:["--line-width","--line-width-xs","--line-width-s","--line-width-m","--line-width-l","--line-width-xl","--base","--base-gap","--base-block-gap","--body-padding","--gap","--grid-gap"],colors:this.getColorTokens(),advanced:["--ratio-golden","--ratio-silver","--ratio-wholestep","--ratio-halfstep","--radius","--blur","--transition","--line-width","--shadow","--border"]},this.defaults={},this.init()}init(){this.storeDefaults(),this.createBadge(),this.initKeyboardShortcuts(),this.restoreTheme(),this.restoreDebugMode();const t=document.documentElement.getAttribute("data-theme");(document.documentElement.classList.contains("standard-debug")||"blueprint"===t)&&this.injectGridDebugOverlays(),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{this.colorScheme=t.matches?"dark":"light","full"===this.state&&this.refreshTokenList()}),this.initModificationTracking()}restoreTheme(){const t=sessionStorage.getItem("standard-theme");t&&document.documentElement.setAttribute("data-theme",t)}restoreDebugMode(){const t=sessionStorage.getItem("standard-debug-mode");"true"===t?document.documentElement.classList.add("standard-debug"):"false"===t&&document.documentElement.classList.remove("standard-debug")}saveDebugMode(t){sessionStorage.setItem("standard-debug-mode",t.toString())}addTheme(t,e){this.customThemes.some(e=>e.value===t)||(this.customThemes.push({value:t,label:e}),"quick"===this.state&&this.createQuickPanel())}storeDefaults(){[...this.coreTokens.typography,...this.coreTokens.layout,...this.coreTokens.colors,...this.coreTokens.advanced].forEach(t=>{const e=getComputedStyle(document.documentElement).getPropertyValue(t).trim();e&&(this.defaults[t]=e)})}getColorTokens(){const t="light"===this.colorScheme?"light":"dark";return[`--color-${t}-background`,`--color-${t}-foreground`,`--color-${t}-accent`,`--color-${t}-red`,`--color-${t}-orange`,`--color-${t}-yellow`,`--color-${t}-green`,`--color-${t}-cyan`,`--color-${t}-blue`,`--color-${t}-purple`,`--color-${t}-pink`]}detectColorScheme(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}loadPosition(){const t=localStorage.getItem("standard-lab-position");return t?JSON.parse(t):{bottom:16,right:16}}savePosition(){localStorage.setItem("standard-lab-position",JSON.stringify(this.position))}createBadge(){this.badge||(this.badge=document.createElement("button"),this.badge.id="standard-lab-badge-container",this.badge.className="standard-lab-badge",this.badge.setAttribute("aria-label","Open Standard Inspector"),this.badge.setAttribute("title","Standard Inspector (Shift+Cmd+S)"),this.badge.setAttribute("style","color:var(--color-subtle);"),this.badge.style.bottom=`${this.position.bottom}px`,this.badge.style.right=`${this.position.right}px`,this.badge.innerHTML="",this.badge.addEventListener("click",()=>this.openQuick()),this.makeDraggable(this.badge),document.body.appendChild(this.badge),this.updateBadge(),this.injectStyles())}updateBadge(){if(!this.badge)return;const t=this.modifiedTokens.size;t>0?this.badge.setAttribute("data-modified",t):this.badge.removeAttribute("data-modified")}makeDraggable(t){let e,n,a,o,r=!1;const s=s=>{if(!r)return;const i=e-s.clientX,d=s.clientY-n;this.position.right=Math.max(0,o+i),this.position.bottom=Math.max(0,a-d),t.style.right=`${this.position.right}px`,t.style.bottom=`${this.position.bottom}px`},i=()=>{r=!1,t.style.cursor="",document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",i),this.savePosition()};t.addEventListener("mousedown",d=>{if(d.target!==t&&!t.classList.contains("standard-lab-panel-header"))return;r=!0,e=d.clientX,n=d.clientY;const l=t.getBoundingClientRect();a=window.innerHeight-l.bottom,o=window.innerWidth-l.right,document.addEventListener("mousemove",s),document.addEventListener("mouseup",i),t.style.cursor="grabbing",d.preventDefault()})}openQuick(){"quick"!==this.state?(this.state="quick",this.createQuickPanel()):this.close()}openFull(){this.state="full",this.createFullPanel()}close(){this.panel&&(this.panel.style.opacity="0",this.panel.style.transform="translateY(10px)",setTimeout(()=>{this.panel&&(this.panel.remove(),this.panel=null)},200)),this.state="dormant"}refresh(){if(console.log("refresh"),this.storeDefaults(),this.badge=null,this.init(),document.documentElement.classList.contains("standard-debug")&&(this.removeGridDebugOverlays(),this.injectGridDebugOverlays()),"dormant"!==this.state)if("quick"===this.state)this.createQuickPanel();else if("full"===this.state){const t=this.panel?.querySelector('[data-filter="modified"]')?.checked||!1;this.createFullPanel(),this.switchTab(this.currentTab);const e=this.panel?.querySelector('[data-filter="modified"]');e&&(e.checked=t,this.refreshTokenList(t))}}createQuickPanel(){this.panel&&this.panel.remove(),this.panel=document.createElement("div"),this.panel.id="standard-lab-panel-container",this.panel.className="standard-lab-panel standard-lab-panel-quick",this.panel.style.bottom=`calc(${this.position.bottom}px + var(--space-2))`,this.panel.style.right=`${this.position.right}px`;const t=document.documentElement.classList.contains("standard-debug"),e=this.modifiedTokens.size;this.panel.innerHTML=`\n      <header class="standard-lab-panel-header">\n          <div>\n            <h2>Inspector v${this.version}</h2>\n            <div class="standard-lab-viewport-info">${window.innerWidth}px</div>\n          </div>\n          <button class="standard-lab-btn-icon" data-action="close" title="Close (Esc)">Ã—</button>\n        </header>\n      <section class="standard-lab-section">\n        <label class="standard-lab-toggle">\n          <input type="checkbox" ${t?"checked":""} data-toggle="debug">\n          <span>Debug Mode</span>\n          <kbd>â‡§âŒ˜D</kbd>\n        </label>\n      </section>\n      <section class="standard-lab-section">\n        <label class="standard-lab-label">Theme</label>\n        <select class="standard-lab-select" data-action="theme">\n          ${this.getThemeOptions()}\n        </select>\n      </section>\n      <div class="standard-lab-actions">\n        <button class="standard-lab-btn" data-action="edit-tokens">\n          ${e>0?`Edit Tokens (${e})`:"Edit Tokens"}\n        </button>\n        ${e>0?'<button class="standard-lab-btn standard-lab-btn-secondary" data-action="reset">Reset</button>':""}\n        <button class="standard-lab-btn standard-lab-btn-secondary" data-action="copy">Copy CSS</button>\n      </div>\n    `,this.attachQuickPanelListeners(),document.body.appendChild(this.panel),requestAnimationFrame(()=>{this.panel.style.opacity="1",this.panel.style.transform="translateY(0)"})}getThemeOptions(){const t=[{value:"",label:"Empty"},{value:"default",label:"Default"},{value:"bauhaus",label:"Bauhaus"},{value:"venetian",label:"Venetian"},{value:"newspaper",label:"Newspaper"},{value:"didone",label:"Didone"},{value:"transitional",label:"Transitional"},{value:"english-oldstyle",label:"English Oldstyle"},{value:"paper",label:"Paper"},{value:"swiss",label:"Swiss"},{value:"kernel",label:"Kernel"},{value:"forest",label:"Forest"},{value:"book",label:"Book"},{value:"minimal",label:"Minimal"},{value:"marauder",label:"Marauder"},{value:"blueprint",label:"Blueprint"},{value:"custom_1",label:"Custom 1"},{value:"custom_2",label:"Custom 2"},{value:"custom_3",label:"Custom 3"},...this.customThemes],e=document.documentElement.getAttribute("data-theme")||"";return t.map(t=>`<option value="${t.value}" ${e===t.value?"selected":""}>${t.label}</option>`).join("")}attachQuickPanelListeners(){this.panel.querySelector('[data-action="close"]')?.addEventListener("click",()=>this.close()),this.panel.querySelector('[data-toggle="debug"]')?.addEventListener("change",t=>{const e=t.target.checked;document.documentElement.classList.toggle("standard-debug",e),this.saveDebugMode(e);const n=document.documentElement.getAttribute("data-theme");e||"blueprint"===n?this.injectGridDebugOverlays():this.removeGridDebugOverlays(),window.toast?.info("Debug mode "+(t.target.checked?"enabled":"disabled"))}),this.panel.querySelector('[data-action="theme"]')?.addEventListener("change",t=>{const e=t.target.value;e?document.documentElement.setAttribute("data-theme",e):document.documentElement.removeAttribute("data-theme"),sessionStorage.setItem("standard-theme",e),this.handleBlueprintDebugException(e),window.toast?.info(`Theme: ${e||"Default"}`)}),this.panel.querySelector('[data-action="edit-tokens"]')?.addEventListener("click",()=>this.openFull()),this.panel.querySelector('[data-action="reset"]')?.addEventListener("click",()=>this.resetAll()),this.panel.querySelector('[data-action="copy"]')?.addEventListener("click",()=>this.copyCSS())}handleBlueprintDebugException(t){const e="blueprint"===t,n=document.documentElement.classList.contains("standard-debug");e&&!n?this.injectGridDebugOverlays():e||n||this.removeGridDebugOverlays()}createFullPanel(){this.panel&&this.panel.remove(),this.panel=document.createElement("div"),this.panel.id="standard-lab-panel-container",this.panel.className="standard-lab-panel standard-lab-panel-full",this.panel.style.bottom=`calc(${this.position.bottom}px + var(--space-2))`,this.panel.style.right=`${this.position.right}px`;const t=this.modifiedTokens.size,e=t>0;this.panel.innerHTML=`\n      <header class="standard-lab-panel-header" style="cursor: grab;">\n        <h2>Token Editor</h2>\n        <div class="standard-lab-header-actions">\n          <button class="standard-lab-btn-icon" data-action="minimize" title="Minimize">âˆ’</button>\n          <button class="standard-lab-btn-icon" data-action="close" title="Close (Esc)">Ã—</button>\n        </div>\n      </header>\n      <nav class="standard-lab-tabs">\n        <button class="standard-lab-tab" data-tab="typography" aria-selected="true">Typography</button>\n        <button class="standard-lab-tab" data-tab="layout">Layout</button>\n        <button class="standard-lab-tab" data-tab="colors">Colors</button>\n        <button class="standard-lab-tab" data-tab="advanced">Advanced</button>\n      </nav>\n      ${t>0?`<div class="standard-lab-filter"><label class="standard-lab-toggle"><input type="checkbox" ${e?"checked":""} data-filter="modified"><span>Show modified only (${t})</span></label></div>`:""}\n      <div class="standard-lab-content">${this.renderTokenList("typography",e)}</div>\n      <div class="standard-lab-actions">\n        <button class="standard-lab-btn standard-lab-btn-secondary" data-action="reset">Reset All</button>\n        <button class="standard-lab-btn" data-action="copy">Copy CSS</button>\n      </div>\n    `,this.attachFullPanelListeners(),this.makeDraggable(this.panel.querySelector(".standard-lab-panel-header")),document.body.appendChild(this.panel),requestAnimationFrame(()=>{this.panel.style.opacity="1",this.panel.style.transform="translateY(0)"})}renderTokenList(t,e=!1){const n=this.coreTokens[t]||[];let a=e?n.filter(t=>this.modifiedTokens.has(t)):n;return 0===a.length?'<div class="standard-lab-empty">No tokens to display</div>':`<div class="standard-lab-token-list">${a.map(t=>this.renderTokenRow(t)).join("")}</div>`}isNumericValue(t){return!!t&&/^-?\d+(\.\d+)?(rem|em|px|%|ch|vh|vw)?$/.test(t.trim())}extractNumericValue(t){if(!t)return 0;const e=t.match(/^(-?\d+(\.\d+)?)/);return e?parseFloat(e[1]):0}extractUnit(t){if(!t)return"";const e=t.match(/[a-z%]+$/i);return e?e[0]:""}renderTokenRow(t){const e=this.getPropertyValue(t),n=this.modifiedTokens.has(t),a=t.includes("color")&&this.isColorValue(e),o=this.sliderConfig[t];if(o&&this.isNumericValue(e)){return`\n        <div class="standard-lab-token-row ${n?"is-modified":""}">\n          <div class="standard-lab-slider-container">\n            <label class="standard-lab-slider-label">${t}</label>\n            <div class="standard-lab-slider-controls">\n              <input\n                type="range"\n                class="standard-lab-slider-input"\n                data-token="${t}"\n                value="${this.extractNumericValue(e)}"\n                min="${o.min}"\n                max="${o.max}"\n                step="${o.step}"\n                title="${t}">\n              <input\n                type="text"\n                class="standard-lab-text-input standard-lab-slider-value"\n                data-token="${t}"\n                value="${e}"\n                spellcheck="false">\n            </div>\n          </div>\n          <button class="standard-lab-btn-icon standard-lab-btn-reset" data-action="reset-token" data-token="${t}" title="Reset" ${n?"":"disabled"}>â†º</button>\n        </div>\n      `}return a?`\n        <div class="standard-lab-token-row ${n?"is-modified":""}">\n          <div class="standard-lab-color-container">\n            <label class="standard-lab-color-label">${t}</label>\n            <div class="standard-lab-color-controls">\n              <input\n                type="color"\n                class="standard-lab-color-input"\n                data-token="${t}"\n                value="${this.extractHexColor(e)}"\n                title="Pick color">\n              <input\n                type="text"\n                class="standard-lab-text-input standard-lab-color-value"\n                data-token="${t}"\n                value="${e}"\n                placeholder="${t}"\n                spellcheck="false">\n            </div>\n          </div>\n          <button class="standard-lab-btn-icon standard-lab-btn-reset" data-action="reset-token" data-token="${t}" title="Reset" ${n?"":"disabled"}>â†º</button>\n        </div>\n      `:`\n      <div class="standard-lab-token-row ${n?"is-modified":""}">\n        <div class="standard-lab-text-container">\n          <label class="standard-lab-text-label">${t}</label>\n          <input type="text" class="standard-lab-text-input" data-token="${t}" value="${e}" placeholder="${t}" spellcheck="false">\n        </div>\n        <button class="standard-lab-btn-icon standard-lab-btn-reset" data-action="reset-token" data-token="${t}" title="Reset" ${n?"":"disabled"}>â†º</button>\n      </div>\n    `}attachFullPanelListeners(){this.panel.querySelector('[data-action="close"]')?.addEventListener("click",()=>this.close()),this.panel.querySelector('[data-action="minimize"]')?.addEventListener("click",()=>this.openQuick()),this.panel.querySelectorAll(".standard-lab-tab").forEach(t=>{t.addEventListener("click",t=>this.switchTab(t.target.dataset.tab))}),this.panel.querySelector('[data-filter="modified"]')?.addEventListener("change",t=>this.refreshTokenList(t.target.checked)),this.panel.querySelectorAll(".standard-lab-slider-input").forEach(t=>{t.addEventListener("input",t=>{const e=t.target.dataset.token,n=`${t.target.value}${this.sliderConfig[e].unit||this.extractUnit(this.getPropertyValue(e))}`;this.updateToken(e,n);const a=this.panel.querySelector(`.standard-lab-slider-value[data-token="${e}"]`);a&&(a.value=n)})}),this.panel.querySelectorAll(".standard-lab-slider-value").forEach(t=>{t.addEventListener("input",t=>{const e=t.target.dataset.token,n=t.target.value,a=this.extractNumericValue(n);this.updateToken(e,n);const o=this.panel.querySelector(`.standard-lab-slider-input[data-token="${e}"]`);o&&(o.value=a)})}),this.panel.querySelectorAll(".standard-lab-text-input:not(.standard-lab-slider-value):not(.standard-lab-color-value)").forEach(t=>{t.addEventListener("input",t=>this.updateToken(t.target.dataset.token,t.target.value))}),this.panel.querySelectorAll(".standard-lab-color-input").forEach(t=>{t.addEventListener("input",t=>{const e=t.target.dataset.token,n=t.target.value;this.updateToken(e,n);const a=this.panel.querySelector(`.standard-lab-color-value[data-token="${e}"]`);a&&(a.value=n)})}),this.panel.querySelectorAll(".standard-lab-color-value").forEach(t=>{t.addEventListener("input",t=>{const e=t.target.dataset.token,n=t.target.value;this.updateToken(e,n);const a=this.panel.querySelector(`.standard-lab-color-input[data-token="${e}"]`);a&&this.isColorValue(n)&&(a.value=this.extractHexColor(n))})}),this.panel.querySelectorAll('[data-action="reset-token"]').forEach(t=>{t.addEventListener("click",t=>this.resetToken(t.target.dataset.token))}),this.panel.querySelector('[data-action="reset"]')?.addEventListener("click",()=>this.resetAll()),this.panel.querySelector('[data-action="copy"]')?.addEventListener("click",()=>this.copyCSS())}switchTab(t){this.currentTab=t,this.panel.querySelectorAll(".standard-lab-tab").forEach(e=>{e.setAttribute("aria-selected",e.dataset.tab===t)});const e=this.panel.querySelector('[data-filter="modified"]')?.checked||!1;this.refreshTokenList(e)}refreshTokenList(t=!1){const e=this.panel?.querySelector(".standard-lab-content");e&&(e.innerHTML=this.renderTokenList(this.currentTab,t),this.attachFullPanelListeners())}updateToken(t,e){document.documentElement.style.setProperty(t,e),e!==this.defaults[t]?this.modifiedTokens.add(t):this.modifiedTokens.delete(t),this.updateBadge();const n=this.panel?.querySelector(`[data-action="reset-token"][data-token="${t}"]`);n&&(n.disabled=!this.modifiedTokens.has(t));const a=this.panel?.querySelector(`.standard-lab-token-row:has([data-token="${t}"])`);a&&a.classList.toggle("is-modified",this.modifiedTokens.has(t)),!t.includes("font-")||t.includes("font-size")||t.includes("font-ratio")||this.loadGoogleFont(e)}resetToken(t){const e=this.defaults[t];if(e){document.documentElement.style.setProperty(t,e),this.modifiedTokens.delete(t);const n=this.panel?.querySelector(`[data-token="${t}"]`);n&&(n.value=e),this.updateBadge(),this.refreshTokenList(),window.toast?.info(`Reset ${t}`)}}resetAll(){confirm("Reset all tokens to defaults?")&&(document.documentElement.removeAttribute("style"),this.modifiedTokens.clear(),this.googleFontsLoaded.clear(),this.updateBadge(),"full"===this.state&&this.refreshTokenList(),window.toast?.info("All tokens reset"))}copyCSS(){const t=`:root {\n${[...this.coreTokens.typography,...this.coreTokens.layout,...this.coreTokens.colors,...this.coreTokens.advanced].map(t=>`  ${t}: ${this.getPropertyValue(t)};`).join("\n")}\n}`;navigator.clipboard.writeText(t).then(()=>window.toast?.success("CSS copied to clipboard!")).catch(()=>{const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),window.toast?.success("CSS copied to clipboard!")})}getPropertyValue(t){return getComputedStyle(document.documentElement).getPropertyValue(t).trim()||document.documentElement.style.getPropertyValue(t).trim()}isColorValue(t){return!!t&&(t.startsWith("#")||t.startsWith("rgb")||t.startsWith("hsl")||t.startsWith("oklch")||t.includes("color-mix"))}extractHexColor(t){if(!t)return"#000000";const e=t.match(/#[0-9a-f]{6}/i);if(e)return e[0];const n=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(n){const[,t,e,a]=n;return"#"+[t,e,a].map(t=>parseInt(t).toString(16).padStart(2,"0")).join("")}return{white:"#ffffff",black:"#000000",red:"#ff0000",green:"#00ff00",blue:"#0000ff",yellow:"#ffff00",orange:"#ffa500",purple:"#800080",pink:"#ffc0cb",cyan:"#00ffff"}[t.toLowerCase()]||"#000000"}loadGoogleFont(t){const e=t.split(",")[0].trim().replace(/['"]/g,"");if(["system-ui","sans-serif","serif","monospace","-apple-system","BlinkMacSystemFont"].includes(e)||this.googleFontsLoaded.has(e))return;const n=`https://fonts.googleapis.com/css2?family=${e.replace(/ /g,"+")}:wght@300;400;500;600;700;900&display=swap`;if(!document.querySelector(`link[href*="${e.replace(/ /g,"+")}"]`)){const t=document.createElement("link");t.rel="stylesheet",t.href=n,document.head.appendChild(t),this.googleFontsLoaded.add(e)}}showNotification(t,e="info"){const n=document.createElement("div");n.className=`standard-lab-notification standard-lab-notification-${e}`,n.textContent=t,document.body.appendChild(n),requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="translateY(0)"}),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateY(-10px)",setTimeout(()=>n.remove(),200)},2500)}initKeyboardShortcuts(){document.addEventListener("keydown",t=>{const e=navigator.platform.indexOf("Mac")>-1;if(t.shiftKey&&(e?t.metaKey:t.ctrlKey)&&"s"===t.key.toLowerCase()&&(t.preventDefault(),"dormant"===this.state?this.openQuick():this.close()),t.shiftKey&&(e?t.metaKey:t.ctrlKey)&&"d"===t.key.toLowerCase()){t.preventDefault(),document.documentElement.classList.toggle("standard-debug");const e=document.documentElement.classList.contains("standard-debug");this.saveDebugMode(e),e?this.injectGridDebugOverlays():this.removeGridDebugOverlays(),window.toast?.info("Debug mode "+(e?"enabled":"disabled"))}"Escape"===t.key&&"dormant"!==this.state&&this.close()})}initModificationTracking(){[...this.coreTokens.typography,...this.coreTokens.layout,...this.coreTokens.colors,...this.coreTokens.advanced].forEach(t=>{const e=this.getPropertyValue(t),n=this.defaults[t];e&&n&&e!==n&&this.modifiedTokens.add(t)}),this.updateBadge()}injectGridDebugOverlays(){document.querySelectorAll(".prose").forEach(t=>{if(t.querySelector(".grid-debug-overlay"))return;const e=document.createElement("div");e.className="grid-debug-overlay",e.setAttribute("aria-hidden","true");for(let t=0;t<7;t++)e.appendChild(document.createElement("span"));t.insertBefore(e,t.firstChild)})}removeGridDebugOverlays(){document.querySelectorAll(".grid-debug-overlay").forEach(t=>t.remove())}injectStyles(){if(document.getElementById("standard-lab-styles"))return;const t=document.createElement("style");t.id="standard-lab-styles",t.textContent='\n      .standard-lab-badge { font-family: var(--font-interface); position: fixed; width: var(--space); height: var(--space); border-radius: 50%; background: var(--color-background-accent); border: var(--border-accent); box-shadow: var(--shadow); backdrop-filter: var(--blur); cursor: pointer; z-index: var(--z-toast); line-height:1.5; display: flex; align-items: baseline; justify-content: center; color: var(--color-foreground); transition: all 0.2s ease; padding: 0; }\n      .standard-lab-badge:hover { box-shadow: var(--shadow); transform: scale(1.05); color: var(--color-accent); }\n      .standard-lab-badge:active { transform: scale(0.95); }\n      .standard-lab-badge[data-modified]::after { content: attr(data-modified); position: absolute; top: -4px; right: -4px; width: 20px; height: 20px; border-radius: 50%; background: var(--color-accent); color: var(--color-background); font-size: var(--scale-d3); display: flex; align-items: center; justify-content: center; font-weight: 600; border: 2px solid var(--color-background); }\n      .standard-lab-panel { position: fixed; font-size: 16px !important; line-height: 1.2 !important; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important; background: var(--modal-background); backdrop-filter: var(--blur); border: var(--border); border-radius: 6px; box-shadow: var(--shadow); z-index: var(--z-toast); opacity: 0; transform: translateY(10px); transition: opacity 0.2s ease, transform 0.2s ease; display: flex; flex-direction: column; }\n      .standard-lab-panel * { font-size: inherit !important; line-height: inherit !important; line-height:1.5 !important; }\n      .standard-lab-panel :is(label, input) { margin:0; }\n      .standard-lab-panel-quick { max-width: 280px; max-height: 400px; }\n      .standard-lab-panel-full { max-width: 360px; max-height: 600px; }\n      .standard-lab-panel-header { padding: 6px; border-bottom: var(--border); display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }\n      .standard-lab-panel-header h2 { margin: 0; font-size: 14px !important; font-weight: 600; letter-spacing: -0.02em; }\n      .standard-lab-viewport-info { font-size: 11px !important; font-weight: 400; color: var(--color-muted); margin-top: 2px; font-family: var(--font-monospace); }\n      .standard-lab-header-actions { display: flex; gap: 6px; }\n      .standard-lab-section { padding: 6px; border-bottom: var(--border); }\n      .standard-lab-section:last-of-type { border-bottom: none; }\n      .standard-lab-label { display: block; font-size: 11px !important; font-weight: 600; color: var(--color-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; }\n      .standard-lab-toggle { display: flex; align-items: center; gap: 6px; cursor: pointer; user-select: none; }\n      .standard-lab-toggle input[type="checkbox"] { width: 16px; height: 16px; cursor: pointer; margin: 0; }\n      .standard-lab-toggle span { flex: 1; font-size: 14px !important; }\n      .standard-lab-toggle kbd { font-size: 12px !important; font-family: var(--font-monospace); color: var(--color-subtle); padding: 2px 6px; background: var(--color-background-secondary); border-radius: 6px; }\n      .standard-lab-select { width: 100%; padding: 6px 3px; margin:0; background: var(--color-background); border: var(--border); border-radius: 6px; font-size: 14px !important; color: var(--color-foreground); cursor: pointer; }\n      .standard-lab-actions { padding: 6px; border-top: var(--border); display: flex; flex-direction: column; gap: 6px; flex-shrink: 0; }\n      .standard-lab-btn { font-size: 12px !important; width: 100%; padding: 6px 3px; background: var(--color-accent); color: var(--color-background); border: border-radius: var(--border); border-radius: 6px; font-size: 14px !important; font-weight: 600; cursor: pointer; transition: opacity 0.2s ease; }\n      .standard-lab-btn:hover { opacity: 0.9; }\n      .standard-lab-btn:active { opacity: 0.8; }\n      .standard-lab-btn-secondary { background: var(--color-background-secondary); color: var(--color-foreground); border: var(--border); }\n      .standard-lab-btn-icon { font-size: 12px !important; width: 24px; height: 24px; padding: 0; background: transparent; border: none; color: var(--color-muted); font-size: 20px !important; line-height: 1 !important; cursor: pointer; border-radius: 6px; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; }\n      .standard-lab-btn-icon:hover { background: var(--color-background-secondary); color: var(--color-foreground); }\n      .standard-lab-tabs { display: flex; border-bottom: var(--border); flex-shrink: 0; }\n      .standard-lab-tab { flex: 1; padding: 6px; background: transparent; border: none; border-bottom: 2px solid transparent; font-size: 16px !important; font-weight: 500; color: var(--color-muted); cursor: pointer; transition: all 0.2s ease; }\n      .standard-lab-tab:hover { color: var(--color-foreground); background: var(--color-background-secondary); }\n      .standard-lab-tab[aria-selected="true"] { color: var(--color-foreground); border-bottom-color: var(--color-accent); font-weight: 600; }\n      .standard-lab-filter { padding: 6px var(--space-d2); background: var(--color-background-secondary); border-bottom: var(--border); flex-shrink: 0; }\n      .standard-lab-content { flex: 1; overflow-y: auto; padding: 6px; }\n      .standard-lab-content::-webkit-scrollbar { width: 6px; }\n      .standard-lab-content::-webkit-scrollbar-track { background: transparent; }\n      .standard-lab-content::-webkit-scrollbar-thumb { background: var(--color-border); border-radius: 6px; }\n      .standard-lab-content::-webkit-scrollbar-thumb:hover { background: var(--color-muted); }\n      .standard-lab-token-list { display: flex; flex-direction: column; gap: 3px; }\n      .standard-lab-token-row { display: grid; grid-template-columns: 1fr auto; gap: 6px; align-items: start; padding: 6px; border-radius: 6px; transition: background 0.2s ease; }\n      .standard-lab-token-row:hover { background: var(--color-background-secondary); }\n      .standard-lab-token-row.is-modified { background: color-mix(in srgb, var(--color-accent) 5%, transparent); }\n      .standard-lab-text-input { padding: 0; background: transparent; border: 1px solid transparent; border-radius: 6px; font-size: 12px !important; font-family: var(--font-monospace); color: var(--color-foreground); min-width: 0; transition: all 0.2s ease; }\n      .standard-lab-text-input:focus { outline: none; background: var(--color-background); border-color: var(--color-accent); }\n      .standard-lab-color-container { width: 100%; }\n      .standard-lab-color-label { display: block; font-size: 11px !important; font-family: var(--font-monospace); color: var(--color-muted); margin-bottom: 6px; }\n      .standard-lab-color-controls { display: flex; gap: 6px; align-items: center; }\n      .standard-lab-color-input { width: 40px; height: 40px; border: var(--border); border-radius: 6px; cursor: pointer; padding: 4px; background: var(--color-background); flex-shrink: 0; }\n      .standard-lab-color-input::-webkit-color-swatch-wrapper { padding: 0; }\n      .standard-lab-color-input::-webkit-color-swatch { border: none; border-radius: 6px; }\n      .standard-lab-color-value { flex: 1; min-width: 0; padding: 0; font-family: var(--font-monospace); font-size: 12px !important; }\n      .standard-lab-text-container { width: 100%; }\n      .standard-lab-text-label { display: block; font-size: 11px !important; font-family: var(--font-monospace); color: var(--color-muted); margin-bottom: 6px; }\n      .standard-lab-slider-container { width: 100%; }\n      .standard-lab-slider-label { display: block; font-size: 11px !important; font-family: var(--font-monospace); color: var(--color-muted); margin-bottom: 6px; }\n      .standard-lab-slider-controls { display: flex; gap: 6px; align-items: center; }\n      .standard-lab-slider-input { flex: 1; height: 6px; -webkit-appearance: none; appearance: none; background: var(--color-background-secondary); border-radius: 6px; outline: none; cursor: pointer; }\n      .standard-lab-slider-input::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: var(--color-accent); border-radius: 50%; cursor: grab; transition: transform 0.1s ease; }\n      .standard-lab-slider-input::-webkit-slider-thumb:active { cursor: grabbing; transform: scale(1.2); }\n      .standard-lab-slider-input::-moz-range-thumb { width: 16px; height: 16px; background: var(--color-accent); border-radius: 50%; border: none; cursor: grab; transition: transform 0.1s ease; }\n      .standard-lab-slider-input::-moz-range-thumb:active { cursor: grabbing; transform: scale(1.2); }\n      .standard-lab-slider-value { width: 80px; flex-shrink: 0; text-align: center; padding: 6px 8px; font-size: 12px !important; }\n      .standard-lab-btn-reset { opacity: 0; transition: opacity 0.2s ease; }\n      .standard-lab-token-row:hover .standard-lab-btn-reset:not(:disabled) { opacity: 1; }\n      .standard-lab-btn-reset:disabled { opacity: 0; cursor: not-allowed; }\n      .standard-lab-empty { padding: var(--space); text-align: center; color: var(--color-subtle); font-size: 14px !important; }\n      .standard-lab-notification { position: fixed; top: var(--space); left: 50%; transform: translateX(-50%) translateY(-10px); background: var(--color-background); border: var(--border); border-radius: 6px; padding: 8px 16px; box-shadow: var(--shadow); z-index: calc(var(--z-toast) + 1); font-size: 14px !important; opacity: 0; transition: opacity 0.2s ease, transform 0.2s ease; pointer-events: none; }\n      .standard-lab-notification-success { background: var(--color-success); color: white; border-color: var(--color-success); }\n      .standard-lab-notification-info { background: var(--color-info); color: white; border-color: var(--color-info); }\n      @media (prefers-color-scheme: dark) { .standard-lab-panel { box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3); } }\n      @media (max-width: 768px) { .standard-lab-panel-quick, .standard-lab-panel-full { width: calc(100vw - 32px); max-width: 360px; } }\n      @media print { .standard-lab-badge, .standard-lab-panel, .standard-lab-notification { display: none !important; } }\n    ',document.head.appendChild(t)}}if("undefined"!=typeof window){const e=()=>{window.StandardLab||(window.StandardLab=new StandardLab,console.log("[StandardLab] âœ“ Initialized"))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e(),document.addEventListener("astro:after-swap",()=>{if(console.log("[StandardLab] ðŸ”„ Page swap detected"),!window.StandardLab)return console.log("[StandardLab] âš ï¸  Instance not found, reinitializing"),void(window.StandardLab=new StandardLab);document.getElementById("standard-lab-badge-container")||(console.log("[StandardLab] ðŸ”¨ Recreating badge"),window.StandardLab.badge=null,window.StandardLab.createBadge());const t=document.getElementById("standard-lab-panel-container");"dormant"===window.StandardLab.state||t||(window.StandardLab.state="dormant",window.StandardLab.panel=null),window.StandardLab.restoreTheme(),window.StandardLab.restoreDebugMode(),document.documentElement.classList.contains("standard-debug")&&window.StandardLab.injectGridDebugOverlays()}),document.body.addEventListener("htmx:afterSettle",()=>{console.log("[StandardLab] âš¡ HTMX swap detected"),window.StandardLab&&window.StandardLab.refresh()})}export default StandardLab;export class GitHubComments{constructor(t={}){this.apiUrl=t.apiUrl||"/api/comments",this.pageId=t.pageId,this.container="string"==typeof t.container?document.querySelector(t.container):t.container||document.querySelector("#comments"),this.formSelector=t.form||"#comment-form",this.comments=[],this.loading=!1,this.pollInterval=t.pollInterval||null,this.pollTimer=null,this.onLoad=t.onLoad||null,this.onRender=t.onRender||null}async load(){if(!this.pageId)return console.error("GitHubComments: pageId is required"),this.error="Configuration error: pageId is required",[];this.loading=!0,this.error=null;try{const t=await fetch(`${this.apiUrl}?pageId=${encodeURIComponent(this.pageId)}`);if(!t.ok)throw new Error(`API error: ${t.status}`);const e=await t.json();if(this.comments=e.comments||[],this.loading=!1,"function"==typeof this.onLoad)try{this.onLoad(this.comments)}catch(t){}return this.comments}catch(t){return console.error("Error loading comments:",t),this.loading=!1,this.error=t.message||"Failed to load comments. Please try again later.",[]}}async submit(t){try{const e=await fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pageId:this.pageId,...t})});if(!e.ok){let t=`API error: ${e.status}`;try{t=(await e.json()).message||t}catch(n){t=`API endpoint not available (${e.status})`}throw new Error(t)}const n=await e.json();return n.comment&&(this.comments.push(n.comment),this.comments.sort((t,e)=>new Date(e.createdAt)-new Date(t.createdAt))),n}catch(t){throw console.error("Error submitting comment:",t),t}}formatTime(t){const e=new Date(t),n=new Date,a=Math.floor((n-e)/1e3);return a<60?"just now":a<3600?`${Math.floor(a/60)}m ago`:a<86400?`${Math.floor(a/3600)}h ago`:a<604800?`${Math.floor(a/86400)}d ago`:e.toLocaleDateString()}escapeHTML(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}formatContent(t){let e=this.escapeHTML(t);return e=e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.+?)\*/g,"<em>$1</em>"),e=e.replace(/_(.+?)_/g,"<em>$1</em>"),e=e.replace(/```(.*?)```/gs,"<pre><code>$1</code></pre>"),e=e.replace(/`(.+?)`/g,"<code>$1</code>"),e=e.replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>'),e=e.replace(/\n/g,"<br>"),e}renderComment(t,e=0){const n=!1!==t.approved?"":' data-pending="true"',a=t.spam?' data-spam="true"':"";return`\n      <div class="comment" data-id="${this.escapeHTML(String(t.id))}" data-level="${e}"${n}${a}>\n        <div class="comment-header">\n          <span class="comment-author">${this.escapeHTML(t.author||"Anonymous")}</span>\n          <span class="comment-date">${this.formatTime(t.createdAt)}</span>\n          ${t.spam?'<span class="comment-flag">Flagged as spam</span>':""}\n          ${t.approved?"":'<span class="comment-pending">Awaiting moderation</span>'}\n        </div>\n        <div class="comment-content">${this.formatContent(t.content||"")}</div>\n      </div>\n    `}buildCommentTree(){const t={},e=[];for(const e of this.comments)t[e.id]={...e,replies:[]};for(const n of this.comments)n.parentId&&t[n.parentId]?t[n.parentId].replies.push(t[n.id]):e.push(t[n.id]);return e}renderTree(t,e=0){return t.map(t=>{let n=this.renderComment(t,e);return t.replies&&t.replies.length>0&&(n+=`<div class="comment-replies">${this.renderTree(t.replies,e+1)}</div>`),n}).join("")}updateFormVisibility(){const t=document.getElementById("show-comment-form-btn");t&&(this.error?t.style.display="none":t.style.display="")}render(){if(!this.container)return void console.error("GitHubComments: container not found");if(this.error)return this.container.innerHTML=`\n        <aside class="comments debug" role="alert">\n          Error loading comments: ${this.escapeHTML(this.error)}\n        </aside>\n      `,void this.updateFormVisibility();if(0===this.comments.length)return this.container.innerHTML='<p class="comments-empty">No comments yet. Be the first to comment!</p>',void this.updateFormVisibility();const t=this.buildCommentTree();if(this.container.innerHTML=this.renderTree(t),this.attachReplyHandlers(),this.updateFormVisibility(),"function"==typeof this.onRender)try{this.onRender(this.container)}catch(t){}}attachReplyHandlers(){this.container&&this.container.querySelectorAll(".comment-reply").forEach(t=>{t.addEventListener("click",t=>{const e=t.target.dataset.parentId,n=document.querySelector(this.formSelector);if(n){const t=n.querySelector('[name="parentId"]');t&&(t.value=e),n.scrollIntoView({behavior:"smooth"})}})})}attachFormHandler(t=null){const e=document.querySelector(t||this.formSelector);if(e){if(e.removeAttribute("hx-boost"),e.setAttribute("hx-disable","true"),window.htmx){const n=e.cloneNode(!0);e.parentNode.replaceChild(n,e);return void document.querySelector(t||this.formSelector).addEventListener("submit",this._handleFormSubmit.bind(this))}e.addEventListener("submit",this._handleFormSubmit.bind(this))}}async _handleFormSubmit(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const e=t.target,n=new FormData(e),a={author:n.get("author"),email:n.get("email"),content:n.get("content"),parentId:n.get("parentId")||null},o=e.querySelector("button[type=submit]"),r=o?o.textContent:"",s=e.querySelector("#form-status");try{o&&(o.disabled=!0,o.textContent="Submitting...",o.style.opacity="0.7"),s&&(s.style.display="block",s.textContent="Sending your comment...",s.style.color="var(--color-foreground, #000)");const t=await this.submit(a);s&&(s.textContent="Comment submitted successfully! It will appear after moderation.",s.style.color="var(--color-green, green)",setTimeout(()=>{s.style.display="none",s.textContent=""},6e3)),e.reset();const n=e.querySelector('[name="parentId"]');return n&&(n.value=""),this.render(),t}catch(t){throw s&&(s.textContent=`Error: ${t.message}`,s.style.color="var(--color-red, red)",s.style.display="block"),t}finally{o&&(o.disabled=!1,o.textContent=r,o.style.opacity="1")}}startPolling(){this.pollInterval&&(this.stopPolling(),this.pollTimer=setInterval(async()=>{const t=this.comments.length;await this.load(),this.comments.length>t&&this.render()},this.pollInterval))}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}}function normalizePageId(t){if(!t||"string"!=typeof t)return"index";let e=t.trim();try{e=new URL(e,window.location.origin).pathname}catch(t){}return e=e.replace(/^\/|\/$/g,""),""===e?"index":(e=e.replace(/[\/]+/g,"_"),e=e.replace(/[^A-Za-z0-9_-]/g,"_"),e)}const COMMENT_DEFAULTS={apiUrl:"/api/comments",containerSelector:"#comments",formSelector:"#comment-form",pollInterval:null,autoInit:!0,pageId:null,onLoad:null,onRender:null};let _instance=null,_configured={...COMMENT_DEFAULTS};function _getPageIdFromDOM(){if("undefined"==typeof document)return null;const t=document.querySelector("[data-page-id]")||document.body,e=t&&t.getAttribute&&t.getAttribute("data-page-id");if(e)return e;const n=document.querySelector('meta[name="page-id"]');if(n&&n.content)return n.content;const a=document.querySelector('meta[property="og:url"]');if(a&&a.content)try{return new URL(a.content).pathname}catch(t){return a.content}const o=document.querySelector('link[rel="canonical"]');if(o&&o.href)try{return new URL(o.href).pathname}catch(t){return o.href}return null}const comments={version:"@VERSION_PLACEHOLDER@",configure:(t={})=>(Object.assign(_configured,t||{}),_configured),getInstance:()=>_instance,createInstance(t={}){const e={apiUrl:_configured.apiUrl,container:t.container||_configured.containerSelector,form:t.formSelector||_configured.formSelector,pollInterval:null!=t.pollInterval?t.pollInterval:_configured.pollInterval,onLoad:t.onLoad||_configured.onLoad,onRender:t.onRender||_configured.onRender},n=t.pageId||_configured.pageId||_getPageIdFromDOM();return e.pageId=normalizePageId(n||window.location.pathname),_instance=new GitHubComments(e),_instance},async init(t={}){if("undefined"==typeof document)return null;if(_instance&&!t.recreate)return _instance;let e=t.container;if(!e){e=document.querySelector("[data-comments]")||document.querySelector(_configured.containerSelector)||_configured.containerSelector}const n=this.createInstance({...t,container:e});try{await n.load(),n.render()}catch(t){}try{n.attachFormHandler(t.formSelector||_configured.formSelector)}catch(t){}return n.pollInterval&&n.startPolling(),n},async load(){return _instance||await this.init(),_instance?_instance.load():[]},render(){if(_instance)return _instance.render();console.error("comments: not initialized")},attachFormHandler(t){if(_instance)return _instance.attachFormHandler(t);console.error("comments: not initialized")},submit:t=>_instance?_instance.submit(t):Promise.reject(new Error("comments: not initialized")),startPolling(){if(_instance)return _instance.startPolling();console.error("comments: not initialized")},stopPolling(){if(_instance)return _instance.stopPolling()},getPageId(){if(_instance&&_instance.pageId)return _instance.pageId;return normalizePageId(_configured.pageId||_getPageIdFromDOM()||("undefined"!=typeof window?window.location.pathname:"index"))}};function setupCommentsAndHTMX(){if(_configured.autoInit&&!_instance)try{comments.init().catch(()=>{})}catch(t){}document.body.addEventListener("htmx:afterSettle",function(t){if(document.querySelector("#comments, [data-comments]")){const t=comments.getInstance();t&&t.stopPolling(),comments.init({recreate:!0})}})}"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",setupCommentsAndHTMX):setupCommentsAndHTMX());export default comments;"undefined"!=typeof window&&(window.comments=comments,window.GitHubComments=GitHubComments);import{initCopyButtons}from"./standard.copy-buttons.js";import{initScrollWrappers}from"./standard.scroll-wrappers.js";let currentTheme=null,scrollState={x:0,y:0};function initializeTheme(){"undefined"!=typeof document&&(currentTheme=document.documentElement.dataset.theme)}function supportsViewTransitions(){return"undefined"!=typeof window&&("startViewTransition"in document&&(!0===window.transitionEnabledOnThisPage||!("transitionEnabledOnThisPage"in window)))}export function setupAstroThemeSwitching(){"undefined"!=typeof window&&(document.addEventListener("astro:before-preparation",t=>{const e=document.documentElement.dataset.theme;e&&(currentTheme=e)}),document.addEventListener("astro:before-swap",t=>{if(t.newDocument){const e=t.newDocument.documentElement.dataset.theme;e&&(currentTheme=e,document.documentElement.dataset.theme=e)}}),document.addEventListener("astro:after-swap",()=>{currentTheme&&(document.documentElement.dataset.theme=currentTheme)}))}export function setupAstroScrollManagement(t={}){const{restoreScroll:e=!1}=t;"undefined"!=typeof window&&(document.addEventListener("astro:before-preparation",()=>{scrollState={x:window.scrollX||0,y:window.scrollY||0}}),document.addEventListener("astro:after-swap",()=>{e?window.scrollTo(scrollState.x,scrollState.y):window.scrollTo(0,0)}))}export function setupAstroReinitialization(){"undefined"!=typeof window&&document.addEventListener("astro:after-swap",()=>{window.imageZoom&&"function"==typeof window.imageZoom.rescan&&window.imageZoom.rescan(),"function"==typeof initScrollWrappers&&initScrollWrappers(document),"function"==typeof initCopyButtons&&initCopyButtons()})}export function setupAstroPageLoadReinitialization(){"undefined"!=typeof window&&document.addEventListener("astro:page-load",()=>{window.imageZoom&&"function"==typeof window.imageZoom.rescan&&window.imageZoom.rescan(),"function"==typeof initScrollWrappers&&initScrollWrappers(document),"function"==typeof initCopyButtons&&initCopyButtons()})}export function setupAstroDebugLogging(){if("undefined"==typeof window||"undefined"==typeof document)return;["astro:before-preparation","astro:after-preparation","astro:before-swap","astro:after-swap","astro:page-load"].forEach(t=>{document.addEventListener(t,e=>{console.log(`[Standard] ${t}`,{type:t,fromURL:e.from?.href||"N/A",toURL:e.to?.href||"N/A",direction:e.direction||"N/A"})})})}export function initAstro(t={}){const{usePageLoad:e=!1,debug:n=!1,restoreScroll:a=!1}=t;if("undefined"==typeof document)return console.warn("[Standard Astro] Document not available - running in non-browser environment"),{success:!1,reason:"non-browser-environment"};const o=supportsViewTransitions();return n&&console.log("[Standard Astro] Initializing...",{viewTransitionsEnabled:o,usePageLoad:e,restoreScroll:a}),initializeTheme(),setupAstroThemeSwitching(),setupAstroScrollManagement({restoreScroll:a}),e?(setupAstroPageLoadReinitialization(),n&&console.log("[Standard Astro] Using astro:page-load event")):(setupAstroReinitialization(),n&&console.log("[Standard Astro] Using astro:after-swap event")),n&&(setupAstroDebugLogging(),console.log("[Standard Astro] Debug logging enabled")),n&&console.log("[Standard Astro] âœ“ Initialization complete"),{success:!0,viewTransitionsEnabled:o,modules:["imageZoom","scrollWrappers","copyButtons"]}}export const astroHelpers={reinitialize(){window.imageZoom&&"function"==typeof window.imageZoom.rescan&&window.imageZoom.rescan(),"function"==typeof initScrollWrappers&&initScrollWrappers(document),"function"==typeof initCopyButtons&&initCopyButtons()},isSupported:()=>supportsViewTransitions(),getCurrentTheme:()=>currentTheme,setTheme(t){currentTheme=t,"undefined"!=typeof document&&(document.documentElement.dataset.theme=t)}};"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{supportsViewTransitions()&&initAstro()}):supportsViewTransitions()&&initAstro());export default initAstro;import{initCopyButtons}from"./standard.copy-buttons.js";import{initScrollWrappers}from"./standard.scroll-wrappers.js";export function setupHTMXThemeSwitching(){document.body.addEventListener("htmx:beforeSwap",t=>{const e=(new DOMParser).parseFromString(t.detail.xhr.responseText,"text/html").documentElement.dataset.theme;e&&(document.documentElement.dataset.theme=e)})}export function setupHTMXReinitialization(){document.body.addEventListener("htmx:afterSettle",function(t){window.imageZoom&&window.imageZoom.rescan(),initScrollWrappers(t.detail.elt),initCopyButtons()})}export function initHTMX(){setupHTMXThemeSwitching(),setupHTMXReinitialization()}"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",initHTMX):initHTMX());export default initHTMX;